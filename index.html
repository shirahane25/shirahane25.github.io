<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,400,400italic,700,700italic|Fira Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Do something cool.">
<meta property="og:type" content="website">
<meta property="og:title" content="Shirahane&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Shirahane&#39;s Blog">
<meta property="og:description" content="Do something cool.">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Shirahane">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Shirahane's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Shirahane's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/11/%E5%8D%81%E4%B8%80%E6%9C%88%E8%81%94%E8%80%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Shirahane">
      <meta itemprop="description" content="Do something cool.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shirahane's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/11/11/%E5%8D%81%E4%B8%80%E6%9C%88%E8%81%94%E8%80%83/" class="post-title-link" itemprop="url">十一月联考</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-11-11 16:41:43 / Modified: 20:01:14" itemprop="dateCreated datePublished" datetime="2025-11-11T16:41:43+08:00">2025-11-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="noip2025-模拟测试赛三十二"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/contest.php?cid=2335">NOIP2025
模拟测试赛（三十二）</a></h2>
<h3 id="problem-a.-沙滩-beach"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/problem.php?cid=2335&amp;pid=0">Problem
A. 沙滩 beach</a></h3>
<p>简单构造赛时全过了没啥好说的</p>
<h3 id="problem-b.-望春风-see"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/problem.php?cid=2335&amp;pid=1">Problem
B. 望春风 see</a></h3>
<blockquote>
<p>对于一个正整数集合 <span class="math inline">\(S\)</span>，它的扩展
<span class="math inline">\(S&#39;\)</span> 通过如下操作得到：</p>
<ul>
<li><p>令 <span class="math inline">\(S&#39; = S\)</span>；</p></li>
<li><p>每次选取 <span class="math inline">\(S&#39;\)</span> 中的一对数
<span class="math inline">\((x,y)\)</span>，满足 <span
class="math inline">\(2 | (x + y)\)</span> 且 <span
class="math inline">\(\dfrac{x+y}{2}\not\in S&#39;\)</span>，将 <span
class="math inline">\(\dfrac{x+y}{2}\)</span> 加入 <span
class="math inline">\(S&#39;\)</span>。</p></li>
</ul>
<p>给定一个长为 <span class="math inline">\(n\)</span> 的正整数序列
<span class="math inline">\(a\)</span>，回答 <span
class="math inline">\(q\)</span> 次询问，每次给定 <span
class="math inline">\(l, r\)</span>，求出若 <span
class="math inline">\(S = \{a_i | l\le i\le r\}\)</span>，拓展集合 <span
class="math inline">\(S&#39;\)</span> 的大小。</p>
<p><span class="math inline">\(1\le n\le 5\cdot 10^5,1\le q\le
3\cdot10^6, V \le 10^{18}\)</span>，其中 <span
class="math inline">\(V\)</span> 是 <span
class="math inline">\(a\)</span> 的值域。</p>
</blockquote>
<p>这种题目最好手玩一下，看看 <span
class="math inline">\(S&#39;\)</span> 的性质。</p>
<p>首先判掉 <span class="math inline">\(|S| = 1\)</span>
的情况。此时答案为 <span class="math inline">\(1\)</span>。</p>
<p>现在 <span class="math inline">\(|S&#39;| \ge
2\)</span>，观察性质。</p>
<p>将 <span class="math inline">\(S&#39;\)</span> 排序。</p>
<p><strong>观察一：<span class="math inline">\(S&#39;\)</span>
的最大值最小值不变，等于 <span class="math inline">\(S\)</span>
的最大值最小值。</strong></p>
<p>每次取数轴上两点的中点，不会超出原有的点的范围。</p>
<p><strong>观察二：<span class="math inline">\(S&#39;\)</span>
是等差数列，且公差 <span class="math inline">\(d \equiv 1\pmod
2\)</span>。</strong></p>
<p>设相邻三个数 <span
class="math inline">\(S&#39;_{i},S&#39;_{i+1},S&#39;_{i+2}\)</span>，记相邻两项的差分别为
<span class="math inline">\(x, y\)</span>。</p>
<p>首先有 <span class="math inline">\(x\equiv y\equiv 1 \pmod
2\)</span>，否则可以再取中点。</p>
<p>而如果 <span class="math inline">\(x\neq
y\)</span>，可以操作第一、三项产生 <span
class="math inline">\(\dfrac{S&#39;_{i} + S&#39;_{i+2}}{2} \neq
S&#39;_{i+1}\)</span>。</p>
<p>已知最大值最小值，只需求出公差 <span
class="math inline">\(d\)</span>，即可求得序列长度。</p>
<p><strong>结论：设 <span class="math inline">\(g\)</span> 为 <span
class="math inline">\(S\)</span> 差分数组的 <span
class="math inline">\(\gcd\)</span>，则 <span class="math inline">\(d =
\dfrac{g}{\text{lowbit}(g)}\)</span></strong>。</p>
<p><span class="math inline">\(S\)</span> 的每个元素都是最小值加上若干倍
<span class="math inline">\(d\)</span>，所以 <span
class="math inline">\(d\)</span> 肯定是每个差分值的因数，也就是差分的
<span class="math inline">\(\gcd\)</span> 的因数。而根据观察二，需要把
<span class="math inline">\(g\)</span> 的所有 <span
class="math inline">\(2\)</span> 因子全部去除。</p>
<p>然后还有经典结论：任意重排数组，差分数组的 <span
class="math inline">\(\gcd\)</span> 不变。</p>
<blockquote>
<p>考察 <span class="math inline">\(3\)</span> 个数 <span
class="math inline">\(a &lt; b &lt; c\)</span>，推广是容易的。 <span
class="math display">\[
\gcd(b - a, c - b) = \gcd(c-a,b-a)=\gcd(c-a,c-b) = \gcd(a-b,c-b)
\]</span></p>
</blockquote>
<p>于是无需排序，只需维护原序列 <span class="math inline">\(a\)</span>
的差分数组的区间 <span class="math inline">\(\gcd,\max,\min\)</span>
即可。</p>
<p><span class="math inline">\(\Theta((q+n)\log V)\)</span>。</p>
<p><a
target="_blank" rel="noopener" href="https://codeforces.com/problemset/problem/2006/C">考察了相似结论的题目</a>。</p>
<h3 id="problem-c.-是是非非-yes"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/problem.php?cid=2335&amp;pid=2">Problem
C. 是是非非 yes</a></h3>
<blockquote>
<p>给定一棵 <span class="math inline">\(n\)</span> 个节点的树，用 <span
class="math inline">\(m\)</span>
种颜色给每个节点染色，称一种染色方案合法当且仅当任意相邻节点的颜色不同。</p>
<p>给定 <span class="math inline">\(X\)</span> 个关键点 <span
class="math inline">\(a_1, a_2,\dots,
a_X\)</span>。对于一种合法的染色方案 <span class="math inline">\(c_1,
c_2,\dots,c_n\)</span>，定义 <span class="math display">\[
Z(c) = |\{c_{a_i} | 1\le i \le X\}|
\]</span> 求出所有合法染色方案的 <span
class="math inline">\(Z^k(c)\)</span> 之和。对 <span
class="math inline">\(998244353\)</span> 取模。</p>
<p><span class="math inline">\(1\le n, m\le 10^5, 1\le k\le
400\)</span>.</p>
</blockquote>
<p>非常好的计数。</p>
<p>设 <span class="math inline">\(F(x)\)</span> 表示 <span
class="math inline">\(Z(c) = x\)</span> 的合法染色方案 <span
class="math inline">\(c\)</span> 的个数。那么答案可以写成 <span
class="math display">\[
\sum_{x=0}^m F(x)x^k
\]</span> 这个 <span class="math inline">\(x^k\)</span>
没有什么很好的性质，但是有恒等式 <span class="math display">\[
x^k = \sum_{j=0}^k\begin{Bmatrix}k\\j\end{Bmatrix}j!\binom{x}{j}
\]</span> 这个式子可以从组合意义角度证明。</p>
<blockquote>
<p>有 <span class="math inline">\(x\)</span> 个不同的物品，有 <span
class="math inline">\(k\)</span> 个位置（标号），可以重复地往这 <span
class="math inline">\(k\)</span> 个位置放物品的方案数是 <span
class="math inline">\(x^k\)</span>。</p>
<p>还可以这样计数，枚举至少出现一次的物品数量 <span
class="math inline">\(j\)</span>，选出 <span
class="math inline">\(j\)</span> 个，乘上 <span
class="math inline">\(\binom{x}{j}\)</span>。</p>
<p>然后把 <span class="math inline">\(k\)</span> 个位置非空地分配给
<span class="math inline">\(j\)</span> 种物品，乘上第二类斯特林数 <span
class="math inline">\(\begin{Bmatrix}k\\j\end{Bmatrix}\)</span>，但斯特林数计数的是无标号集合，所以还要排列，乘上
<span class="math inline">\(j!\)</span>。</p>
</blockquote>
<p>代回原式 <span class="math display">\[
\begin{aligned}
&amp;\sum_{x=0}^m F(x)x^k\\
=&amp;\sum_{x=0}^mF(x)\sum_{j=0}^k\begin{Bmatrix}k\\j\end{Bmatrix}j!\binom{x}{j}\\
=&amp;\sum_{j=0}^k\begin{Bmatrix}k\\j\end{Bmatrix}j!\color{red}{\sum_{x=0}^m
F(x)\binom{x}{j}}
\end{aligned}
\]</span> 令红色部分为关于 <span class="math inline">\(j\)</span> 的函数
<span class="math inline">\(T(j)\)</span>。</p>
<p>考察 <span class="math inline">\(T(j)\)</span> 的组合意义。</p>
<p>回顾 <span class="math inline">\(F(x)\)</span> 的定义：<span
class="math inline">\(Z(c) = x\)</span> 的合法染色方案 <span
class="math inline">\(c\)</span> 的个数。</p>
<p>乘上 <span
class="math inline">\(\binom{x}{j}\)</span>，也就是从关键点集合已有的颜色中选出
<span class="math inline">\(j\)</span> 个颜色的方案数。</p>
<p>所以 <span class="math inline">\(T(j)\)</span>
的组合意义是：合法的染色方案数，使得 <span
class="math inline">\(j\)</span>
个颜色都至少在某些关键点出现了一次。</p>
<p>我们不关心具体是哪 <span class="math inline">\(j\)</span>
个颜色，所以先除掉一个组合数。 <span class="math display">\[
T(j) = \binom{m}{j}A(j)
\]</span> 现在可以把颜色分成两类：选定的 <span
class="math inline">\(j\)</span> 个颜色，我称之为第一类颜色；和没选定的
<span class="math inline">\(m-j\)</span>
个颜色，我称之为第二类颜色。</p>
<p>其中 <span class="math inline">\(A(j)\)</span>
表示：合法染色方案数，使得每个第一类颜色都至少在某些关键点出现了一次的方案数。</p>
<p>套路地容斥，计数合法染色方案数，使得恰好 <span
class="math inline">\(0\)</span> 个第一类颜色未在任何关键点出现。 <span
class="math display">\[
A(j) = \sum_{i=0}^j(-1)^i\binom{j}{i}h(i)
\]</span> 其中 <span class="math inline">\(h(i)\)</span>
表示合法的染色方案数，使得 <span class="math inline">\(i\)</span>
个第一类颜色均不在任何关键点出现的方案数。</p>
<p>为了求出 <span class="math inline">\(h(i)\)</span>，考虑树形
DP。设</p>
<ul>
<li><span class="math inline">\(f_{u,0}\)</span> 表示节点 <span
class="math inline">\(u\)</span> 放了某个第一类颜色的方案数。</li>
<li><span class="math inline">\(f_{u, 1}\)</span> 表示节点 <span
class="math inline">\(u\)</span> 放了某个第二类颜色的方案数。</li>
</ul>
<p>注意状态的定义，我们还没有确定具体是哪个颜色（还没标号）。</p>
<p>考虑转移，先考虑 <span class="math inline">\(u\)</span>
放某个第二类颜色，这对 <span class="math inline">\(u\)</span>
是否是关键点没有限制。</p>
<p>考察 <span class="math inline">\(u\)</span> 的每个儿子 <span
class="math inline">\(v\)</span>，如果 <span
class="math inline">\(v\)</span>
放第一类颜色，随便哪个都可以，乘上标号，方案数 <span
class="math inline">\(if_{v,0}\cdot\)</span>。</p>
<p>如果 <span class="math inline">\(v\)</span> 放第二类颜色，不能放和
<span class="math inline">\(u\)</span>
一样的，会少一个，乘上标号，方案数 <span
class="math inline">\((m-1-i)f_{v, 1}\)</span>。</p>
<p>发现每个儿子之间互不影响，所以全部乘起来 <span
class="math display">\[
f_{u, 1} = \prod_{v\in \text{child}(u)}\left(if_{v, 0} +
(m-1-i)f_{v,1}\right)
\]</span> 现在考虑 <span class="math inline">\(u\)</span>
放第第一类颜色。如果 <span class="math inline">\(u\)</span>
是关键点，它不能放第一类颜色，<span class="math inline">\(f_{u, 0} =
0\)</span>。</p>
<p>否则，类似地，考察 <span class="math inline">\(u\)</span> 的每个儿子
<span class="math inline">\(v\)</span>。如果 <span
class="math inline">\(v\)</span> 放第一类颜色，不能和 <span
class="math inline">\(u\)</span> 一样，会少一种，乘上标号，方案数 <span
class="math inline">\((i-1)f_{v,0}\)</span>。</p>
<p>如果 <span class="math inline">\(v\)</span>
放第二类颜色，随便哪个都可以，乘上标号，方案数 <span
class="math inline">\((m-i)f_{v,1}\)</span>。</p>
<p>每个儿子之间互不影响，全部乘起来 <span class="math display">\[
f_{u,0} = \prod_{v\in\text{child}(u)}((i-1)f_{v,0}+(m-i)f_{v, 1})
\]</span> 不妨设根为 <span class="math inline">\(1\)</span>，最终 <span
class="math display">\[
h(i) = if_{1,0}+(m-i)f_{1,1}
\]</span> 全部往回代即可求出答案。</p>
<p>答案 <span class="math display">\[
\sum_{j=0}^k\begin{Bmatrix}k\\j\end{Bmatrix}j!\binom{m}{j}\sum_{i=0}^j(-1)^i\binom{j}{i}h(i)
\]</span> 时间复杂度 <span class="math inline">\(\Theta(kn +
k^2)\)</span>。</p>
<h2 id="noip2025-模拟测试赛三十三"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/contest.php?cid=2336">NOIP2025
模拟测试赛（三十三）</a></h2>
<h3 id="problem-a.-前缀和与差分-coprime"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/problem.php?cid=2336&amp;pid=0">Problem
A. 前缀和与差分 coprime</a></h3>
<blockquote>
<p>对于一个数组 <span class="math inline">\(a\)</span> 定义 <span
class="math inline">\(\gcd(a)\)</span> 为 <span
class="math inline">\(a\)</span> 中所有元素的 <span
class="math inline">\(\gcd\)</span>。</p>
<p>定义 <span class="math inline">\(f(n,m) = \sum\limits_{\text{valid}
a} \gcd^2(a)\)</span>，其中合法的 <span class="math inline">\(a\)</span>
长为 <span class="math inline">\(n\)</span>，且每个元素都是 <span
class="math inline">\([1, m]\)</span> 的整数。</p>
<p>给定 <span class="math inline">\(n, m\)</span>，对所有 <span
class="math inline">\(1\le i\le m\)</span> 求出 <span
class="math inline">\(f(n,i)\)</span>。</p>
<p>最后输出 <span class="math display">\[
\sum_{i=1}^m p^{m-i}(f(n,i)\bmod p)
\]</span> 对 <span class="math inline">\(10^9 +7\)</span>
取模的结果。其中 <span class="math inline">\(p =
998244353\)</span>。</p>
<p><span class="math inline">\(1\le n, m\le 2\cdot 10^7\)</span>。</p>
</blockquote>
<p>考虑求出 <span class="math inline">\(f(n, m)\)</span>。</p>
<p>枚举 <span class="math inline">\(\gcd = i\)</span>，记 <span
class="math inline">\(A(i)\)</span> 为合法的数组数量，满足 <span
class="math inline">\(\gcd = i\)</span>。那么答案为 <span
class="math display">\[
f(n, m) = \sum_{i=1}^m i^2 A(i)
\]</span> 求出 <span class="math inline">\(A(i)\)</span>
比较困难。容斥。设 <span class="math inline">\(B(i)\)</span>
为合法的数组数量，满足每个数都被 <span class="math inline">\(i\)</span>
整除。有 <span class="math display">\[
B(i) = \sum_{i|j} A(j) \Leftrightarrow A(i) =
\sum_{i|j}\mu\left(\dfrac{j}{i}\right)B(j)
\]</span> 而 <span class="math inline">\(B(j)\)</span> 是好求的 <span
class="math display">\[
B(j) = \left\lfloor\dfrac{m}{j}\right\rfloor^n
\]</span> 于是 <span class="math display">\[
A(i) =
\sum_{i|j}\mu\left(\dfrac{j}{i}\right)\left\lfloor\dfrac{m}{j}\right\rfloor^n
\]</span> 代回答案的式子 <span class="math display">\[
f(n, m) = \sum_{i=1}^m
i^2\sum_{i|j}\mu\left(\dfrac{j}{i}\right)\left\lfloor\dfrac{m}{j}\right\rfloor^n
\]</span> 交换求和顺序 <span class="math display">\[
f(n, m) =
\sum_{j=1}^m\left\lfloor\dfrac{m}{j}\right\rfloor^n\sum_{i|j}i^2\mu\left(\dfrac{j}{i}\right)
\]</span> 后面那坨是积性函数，可以线性筛 <span
class="math inline">\(\Theta(m)\)</span> 预处理出来，数论分块，可以做到
<span class="math inline">\(\Theta(\sqrt m\log n)\)</span>
求值，这是单个 <span class="math inline">\(f(n,
m)\)</span>，于是总复杂度 <span class="math inline">\(\Theta(m\sqrt
m\log n)\)</span>，无法通过。</p>
<p>之后的步骤比较智慧。</p>
<p>令后面那个积性函数为 <span class="math inline">\(h\)</span>： <span
class="math display">\[
h(j) = \sum_{i|j}i^2\mu\left(\dfrac{j}{i}\right)
\]</span></p>
<p>代回答案 <span class="math display">\[
f(n,m) = \sum_{j=1}^mh(j)\left\lfloor\dfrac{m}{j}\right\rfloor^n\\
\]</span>
如果保留整除形式，不可避免的会出现根号。我们希望不要出现整除，换成一些数论函数的求和，考虑差分，设
<span class="math display">\[
g(x) = x^n - (x-1)^n
\]</span> 写成前缀和形式 <span class="math display">\[
\begin{aligned}
f(n,m) &amp;= \sum_{j=1}^mh(j)\left\lfloor\dfrac{m}{j}\right\rfloor^n\\
&amp;=\sum_{j=1}^mh(j)\sum_{i=1}^{\left\lfloor\frac{m}{j}\right\rfloor}g(i)\\
&amp;=\sum_{j=1}^mh(j)\sum_{ij\le m} g(i)\\
&amp;=\sum_{ij\le m} h(j)g(i)\\
&amp;= \sum_{i=1}^m\sum_{d|i}h(i)g\left(\dfrac{i}{d}\right)\\
&amp;= \sum_{i=1}^m (h * g)(i)
\end{aligned}
\]</span> 也即 <span class="math inline">\(f(n, m)\)</span> 等于 <span
class="math inline">\(h * g\)</span> 的前 <span
class="math inline">\(m\)</span> 项和。只需求出 <span
class="math inline">\(h * g\)</span>，做前缀和即可做到单次查询 <span
class="math inline">\(\Theta(1)\)</span>。</p>
<p>直接卷是 <span class="math inline">\(\Theta(m\ln m)\)</span>
的，但因为 <span class="math inline">\(h\)</span> 是积性函数，<a
target="_blank" rel="noopener" href="https://www.cnblogs.com/HaHeHyt/p/17185823.html#-%E4%B8%BA%E7%A7%AF%E6%80%A7%E5%BF%AB%E9%80%9F%E7%8B%84%E5%88%A9%E5%85%8B%E9%9B%B7%E5%8D%B7%E7%A7%AF-">这个卷积可以做到
<span class="math inline">\(\Theta(m\log\log m)\)</span></a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/08/%E8%AE%A1%E6%95%B0%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Shirahane">
      <meta itemprop="description" content="Do something cool.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shirahane's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/11/08/%E8%AE%A1%E6%95%B0%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">计数入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-11-08 09:12:59" itemprop="dateCreated datePublished" datetime="2025-11-08T09:12:59+08:00">2025-11-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-11-11 19:30:31" itemprop="dateModified" datetime="2025-11-11T19:30:31+08:00">2025-11-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>注意：本文章还很不完善</strong></p>
<p><strong>注意：本文章属于个人笔记不是教程</strong></p>
<h2 id="前置知识">前置知识</h2>
<h3 id="二项式系数">二项式系数</h3>
<p>组合意义：在 <span class="math inline">\(n\)</span> 个不同的物品中选
<span class="math inline">\(m\)</span> 个的方案数。 <span
class="math display">\[
\begin{gather*}
\binom{n}{m} = \dfrac{n!}{m!(n-m)!}\\
\binom{n}{m} = \binom{n-1}{m} + \binom{n-1}{m-1}
\end{gather*}
\]</span></p>
<h3 id="多重集的排列数-多重组合数">多重集的排列数 / 多重组合数</h3>
<p><span class="math inline">\(n\)</span> 个物品，<span
class="math inline">\(m\)</span> 种颜色，每种颜色的物品视作相同，第
<span class="math inline">\(i\)</span> 种颜色有 <span
class="math inline">\(a_i\)</span> 个（<span class="math inline">\(\sum
a_i = n\)</span>），求排列方案数 <span class="math display">\[
\binom{n}{a_1, a_2,\dots,a_m} = \dfrac{n!}{\prod a_i!}
\]</span> 发现 <span class="math inline">\(\binom{n}{m} = \binom{n}{m, n
- m}\)</span>，但没什么用。</p>
<h3 id="二项式推论-组合恒等式">二项式推论 / 组合恒等式</h3>
<p>待补</p>
<h3 id="球盒模型">球盒模型</h3>
<p>有 <span class="math inline">\(n\)</span> 个球，<span
class="math inline">\(m\)</span> 个盒子。要将 <span
class="math inline">\(n\)</span> 个球放入 <span
class="math inline">\(m\)</span> 个盒子中。</p>
<p>我们考察：球是否有标号、盒是否有标号、盒是否可空。</p>
<p>盒是否有标号其实无所谓，把有标号的方案数除以 <span
class="math inline">\(m!\)</span> 即可。下面只考察盒子
<strong>有标号</strong> 的情况。</p>
<h4 id="球无标号盒非空">球无标号，盒非空</h4>
<p><span class="math inline">\(n\)</span> 个无标号球放入 <span
class="math inline">\(m\)</span> 个有标号盒子，盒子非空的方案数。</p>
<p>插板法，把 <span class="math inline">\(n\)</span>
个球排成一行，相当于把 <span class="math inline">\(m-1\)</span>
个隔板插入 <span class="math inline">\(n-1\)</span> 个间隙中的方案数。
<span class="math display">\[
\binom{n-1}{m-1}
\]</span> 问题等价于 <span class="math inline">\(x_1 + x_2 + \cdots +
x_m = n\)</span> 的正整数解的个数。</p>
<h4 id="球无标号盒可空">球无标号，盒可空</h4>
<p><span class="math inline">\(n\)</span> 个无标号球放入 <span
class="math inline">\(m\)</span> 个有标号盒子，盒子可空的方案数。</p>
<p>问题等价于 <span class="math inline">\(x_1 + x_2 + \cdots + x_m =
n\)</span> 的非负整数解的个数。</p>
<p>令 <span class="math inline">\(a_i = x_i + 1\)</span>，问题等价于
<span class="math inline">\(a_1 + a_2 + \cdots + a_m = n + m\)</span>
的正整数解的个数。转化为前一个模型，插板法解得 <span
class="math display">\[
\binom{n+m-1}{m-1} = \binom{n+m-1}{n}
\]</span></p>
<h4 id="球有标号盒可空">球有标号，盒可空</h4>
<p>每个球都可以选择放入 <span class="math inline">\(m\)</span>
个盒子中的任意一个，方案数为 <span
class="math inline">\(m^n\)</span>。</p>
<h4 id="球有标号盒非空">球有标号，盒非空</h4>
<p>类似前一个模型，但是要求盒子非空，对着这个限制容斥，即求恰好 <span
class="math inline">\(0\)</span> 个盒子为空的方案数，钦定 <span
class="math inline">\(i\)</span>
个盒子为空，剩下的盒子随意放，二项式反演得 <span class="math display">\[
\sum_{i=0}^m(-1)^i\binom{m}{i}(m-i)^n
\]</span></p>
<h3 id="二项式定理">二项式定理</h3>
<p><span class="math display">\[
(a+b)^n = \sum_{i=0}^n\binom{n}{i}a^ib^{n-i}
\]</span></p>
<h3 id="容斥原理">容斥原理</h3>
<p>待补</p>
<h3 id="二项式反演">二项式反演</h3>
<p>很好用的反演。</p>
<p>有两个形式，其中最常用的是这个 <span class="math display">\[
f(k) = \sum_{i=k}\binom{i}{k}g(i) \Leftrightarrow g(k) =
\sum_{i=k}(-1)^{i-k}\binom{i}{k}f(i)
\]</span> 求和上界无所谓，因为一般的问题到了一定规模 <span
class="math inline">\(f\)</span> 和 <span
class="math inline">\(g\)</span> 都是 <span
class="math inline">\(0\)</span>。</p>
<p>组合意义：设</p>
<ul>
<li><span class="math inline">\(g(k)\)</span> 表示恰好选择 <span
class="math inline">\(k\)</span> 个物品的方案数；</li>
<li><span class="math inline">\(f(k)\)</span> 表示 <strong>钦定</strong>
选择 <span class="math inline">\(k\)</span> 个物品的方案数。</li>
</ul>
<p>名词解释：钦定 <span class="math inline">\(k\)</span>
个意味着，我们强制要求这 <span class="math inline">\(k\)</span>
个物品满足一定要求，剩下的物品放任自流，不管它是否满足要求。即，选了
<span class="math inline">\(k\)</span> 个物品，然后再算包含这 <span
class="math inline">\(k\)</span> 个物品的方案数，会重复。</p>
<p>已知 <span class="math inline">\(g\)</span> 可以方便求 <span
class="math inline">\(f\)</span>，但大部分问题中，求恰好是比较困难的，但求钦定比较方便，于是可以通过二项式反演已知
<span class="math inline">\(f\)</span> 求出 <span
class="math inline">\(g\)</span>。注意到 <span class="math inline">\(k =
0\)</span> 时形式和普通容斥相同。</p>
<h2 id="热身题">热身题</h2>
<h3 id="问题一">问题一</h3>
<blockquote>
<p>计数长为 <span class="math inline">\(n\)</span> 的错排个数，<span
class="math inline">\(n \le 10^6\)</span></p>
</blockquote>
<p>即求恰好 <span class="math inline">\(0\)</span> 个位置满足 <span
class="math inline">\(p_i = i\)</span> 的排列数，钦定 <span
class="math inline">\(i\)</span>
个这样的位置，剩下的没有限制可以随意排列，二项式反演可得 <span
class="math display">\[
\sum_{i=0}^n(-1)^i\binom{n}{i}(n-i)!
\]</span></p>
<h3 id="问题二">问题二</h3>
<blockquote>
<p>计算第二类斯特林数 <span class="math inline">\(S(n, m)\)</span>：将
<span class="math inline">\(n\)</span> 个有标号小球放入 <span
class="math inline">\(m\)</span>
个无标号盒子，且每个盒子非空的方案数</p>
<p><span class="math inline">\(n, m \le 8000\)</span></p>
</blockquote>
<p>先给盒子标号，最后除以 <span class="math inline">\(m!\)</span>
去掉标号。</p>
<p>如果不要求盒子非空，每个球都有 <span class="math inline">\(m\)</span>
种选法，即 <span class="math inline">\(m^n\)</span>
种。现要求盒子非空，对着这个限制容斥，即求恰好 <span
class="math inline">\(0\)</span> 个盒子为空的方案数，钦定 <span
class="math inline">\(i\)</span>
个盒子为空，剩下的盒子随意放，二项式反演得 <span class="math display">\[
\dfrac{1}{m!}\sum_{i=0}^m(-1)^i\binom{m}{i}(m-i)^n
\]</span> 当然也可以递推，考察第 <span class="math inline">\(n\)</span>
个球的放入情况，可以新开一个盒子，也可以放入已有的 <span
class="math inline">\(m\)</span> 个盒子中的 <span
class="math inline">\(1\)</span> 个 <span class="math display">\[
S(n, m) = S(n - 1, m - 1) + mS(n-1,m)
\]</span> 其中规定：<span class="math inline">\(S(0, 0) = 1, S(n, 0)=
0(n &gt; 0), S(n, m) = 0(m &gt; n)\)</span></p>
<h3 id="问题三">问题三</h3>
<blockquote>
<p>计数把长为 <span class="math inline">\(n\)</span> 的格子，染恰好
<span class="math inline">\(m\)</span>
种颜色，且相邻格子颜色不同的方案数</p>
<p><span class="math inline">\(n\le 10^9, m\le10^6\)</span></p>
</blockquote>
<p><del>其实根据数据范围可以猜出要对着颜色容斥</del></p>
<p>如果不要求每种颜色都出现一次，答案为 <span
class="math inline">\(m(m-1)^{n-1}\)</span>。</p>
<p>对着这个限制容斥，即求恰好 <span class="math inline">\(0\)</span>
个颜色不出现的方案数，钦定 <span class="math inline">\(i\)</span>
个颜色不出现，剩下的放入。 <span class="math display">\[
\sum_{i=0}^m(-1)^i\binom{m}{i}(m-i)(m-1-i)^{n-1}
\]</span></p>
<h3 id="问题四">问题四</h3>
<blockquote>
<p>计数把 <span class="math inline">\(n \times m\)</span>
的网格图黑白染色，要求每行每列至少有一个黑色的方案数</p>
<p><span class="math inline">\(n, m\le 10^6\)</span></p>
</blockquote>
<p>即计数恰好 <span class="math inline">\(0\)</span> 行全白，恰好 <span
class="math inline">\(0\)</span> 列全白的方案数。</p>
<p>考虑一个暴力容斥，钦定 <span class="math inline">\(i\)</span>
行全白，<span class="math inline">\(j\)</span>
列全白，剩下的随便染色，方案数是 <span class="math display">\[
\sum_{i=0}^n\sum_{j=0}^m(-1)^{i+j}\binom{n}{i}\binom{m}{j}2^{(n-i)(m-j)}
\]</span> 这是 <span class="math inline">\(\Theta(nm)\)</span>
的求和，考虑化简这个式子，把和 <span class="math inline">\(j\)</span>
无关的量都提到外层求和 <span class="math display">\[
\begin{aligned}
&amp;\sum_{i=0}^n(-1)^i\binom{n}{i}\sum_{j=0}^{m}(-1)^j\binom{m}{j}2^{(n-i)(m-j)}\\
=&amp;\sum_{i=0}^n(-1)^i\binom{n}{i}2^{(n-i)m}\sum_{j=0}^{m}(-1)^j\binom{m}{j}2^{-(n-i)j}\\
=&amp;\sum_{i=0}^n(-1)^i\binom{n}{i}2^{(n-i)m}\sum_{j=0}^{m}(-1)^j\binom{m}{j}\left(2^{-(n-i)}\right)^j\\
=&amp;\sum_{i=0}^n(-1)^i\binom{n}{i}2^{(n-i)m}\sum_{j=0}^{m}\binom{m}{j}\left(-2^{-(n-i)}\right)^j\\
=&amp;\sum_{i=0}^n(-1)^i\binom{n}{i}2^{(n-i)m}\left(1-2^{-(n-i)}\right)^m\\
=&amp;\sum_{i=0}^n(-1)^i\binom{n}{i}\left(2^{n-i}\right)^m\left(1-2^{-(n-i)}\right)^m\\
=&amp;\boxed{\sum_{i=0}^n(-1)^i\binom{n}{i}\left(2^{n-i} - 1\right)^m}
\end{aligned}
\]</span>
当然也有个更好的思路，我们考虑对着行容斥，先不管每行能否保证至少一个黑，如果要求每列至少一个黑，每列之间是独立的，每一列至少一个黑的方案数是
<span class="math inline">\(2^n-1\)</span>，那么 <span
class="math inline">\(m\)</span> 列就是 <span
class="math inline">\(\left(2^n - 1\right)^m\)</span>。</p>
<p>现在我们要求恰好 <span class="math inline">\(0\)</span> 行全白，钦定
<span class="math inline">\(i\)</span>
行全白，剩下的随便填（但要求每列至少一个黑）然后容斥即可 <span
class="math display">\[
\boxed{\sum_{i=0}^n(-1)^i\binom{n}{i}\left(2^{n-i}-1\right)^m}
\]</span> 得到了相同的式子。</p>
<h3 id="问题五">问题五</h3>
<blockquote>
<p><span class="math inline">\(n\)</span> 个物品，每次有 <span
class="math inline">\(p_i\)</span> 的概率取第 <span
class="math inline">\(i\)</span>
个，求每个物品都至少取了一次的期望时间</p>
<p><span class="math inline">\(n\le 26,\sum\limits_{i=1}^n p_i =
1\)</span></p>
</blockquote>
<p>我不会这个东西 /ll</p>
<h2 id="实战">实战</h2>
<h3 id="cf1228e.-another-filling-the-grid"><a
target="_blank" rel="noopener" href="https://codeforces.com/problemset/problem/1228/E">CF1228E. Another
Filling the Grid</a></h3>
<blockquote>
<p>给定一个 <span class="math inline">\(n\times n\)</span> 网格和整数
<span class="math inline">\(k\)</span>。要在每个格子中填入 <span
class="math inline">\([1, k]\)</span> 的整数，使得每行每列的最小值都为
<span class="math inline">\(1\)</span>。求合法的填数方案数。</p>
<p><span class="math inline">\(1\le n\le 250, 1\le k\le
10^9\)</span>.</p>
</blockquote>
<p>也就是每行每列都至少出现一个 <span
class="math inline">\(1\)</span>。也就是求恰好 <span
class="math inline">\(0\)</span> 行 <span
class="math inline">\(0\)</span> 列没有 <span
class="math inline">\(1\)</span>。暴力容斥 <span class="math display">\[
\sum_{i=0}^n\sum_{j=0}^n(-1)^{i+j}\binom{n}{i}\binom{n}{j}(k-1)^{n(i+j)-ij}k^{(n-i)(n-j)}
\]</span> <span class="math inline">\(\Theta(n^2)\)</span>。</p>
<h3 id="p2167-sdoi2009-bill的挑战"><a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2167">P2167 [SDOI2009]
Bill的挑战</a></h3>
<blockquote>
<p>给出 <span class="math inline">\(n\)</span>
个长度相同的字符串（由小写英文字母和 <span class="math inline">\(\tt
?\)</span> 组成），求与这 <span class="math inline">\(n\)</span>
个串中的恰好 <span class="math inline">\(k\)</span> 个串匹配的字符串
<span class="math inline">\(T\)</span> 的个数，答案对 <span
class="math inline">\(10^6 + 3\)</span> 取模。</p>
<p>若字符串 <span class="math inline">\(S\)</span> 和 <span
class="math inline">\(T\)</span> 匹配，满足以下条件：</p>
<ol type="1">
<li><span class="math inline">\(|S| = |T|\)</span>。</li>
<li>对于任意的 <span class="math inline">\(1\le i \le |S|\)</span>，满足
<span class="math inline">\(S_i = \tt{?}\)</span> 或 <span
class="math inline">\(S_i = T_i\)</span>。</li>
</ol>
<p>其中 <span class="math inline">\(T\)</span> 只包含小写英文字母。</p>
<p><span class="math inline">\(1\le n \le 15, 1\le |S_i| \le
50\)</span>.</p>
</blockquote>
<p>设 <span class="math inline">\(f(k)\)</span> 表示恰与 <span
class="math inline">\(k\)</span> 个模式匹配的字符串 <span
class="math inline">\(T\)</span> 的个数。枚举子集 <span
class="math inline">\(U\)</span>，看每一位。</p>
<ul>
<li>如果都是 <span class="math inline">\(\tt ?\)</span>，那么这一位有
<span class="math inline">\(26\)</span> 种填法；</li>
<li>如果只出现了一个字母，只有唯一的 <span
class="math inline">\(1\)</span> 种填法；</li>
<li>出现了多个字母，这一位没有填法。</li>
</ul>
<p>每一位的贡献乘起来然后累加到 <span
class="math inline">\(f(|U|)\)</span>。然后就是套路的二项式反演了 <span
class="math display">\[
\sum_{i=k}^n(-1)^{i-k}\binom{i}{k}f(i)
\]</span> <span class="math inline">\(\Theta(|S|2^n)\)</span>.</p>
<h3 id="联考-是是非非"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/problem.php?cid=2335&amp;pid=2">联考
是是非非</a></h3>
<blockquote>
<p>给定一棵 <span class="math inline">\(n\)</span> 个节点的树，用 <span
class="math inline">\(m\)</span>
种颜色给每个节点染色，称一种染色方案合法当且仅当任意相邻节点的颜色不同。</p>
<p>给定 <span class="math inline">\(X\)</span> 个关键点 <span
class="math inline">\(a_1, a_2,\dots,
a_X\)</span>。对于一种合法的染色方案 <span class="math inline">\(c_1,
c_2,\dots,c_n\)</span>，定义 <span class="math display">\[
Z(c) = |\{c_{a_i} | 1\le i \le X\}|
\]</span> 求出所有合法染色方案的 <span
class="math inline">\(Z^k(c)\)</span> 之和。对 <span
class="math inline">\(998244353\)</span> 取模。</p>
<p><span class="math inline">\(1\le n, m\le 10^5, 1\le k\le
400\)</span>.</p>
</blockquote>
<p>设 <span class="math inline">\(F(x)\)</span> 表示 <span
class="math inline">\(Z(c) = x\)</span> 的合法染色方案 <span
class="math inline">\(c\)</span> 的个数。那么答案可以写成 <span
class="math display">\[
\sum_{x=0}^m F(x)x^k
\]</span> 这个 <span class="math inline">\(x^k\)</span>
没有什么很好的性质，但是有恒等式 <span class="math display">\[
x^k = \sum_{j=0}^k\begin{Bmatrix}k\\j\end{Bmatrix}j!\binom{x}{j}
\]</span> 这个式子可以从组合意义角度证明。</p>
<blockquote>
<p>有 <span class="math inline">\(x\)</span> 个不同的物品，有 <span
class="math inline">\(k\)</span> 个位置（标号），可以重复地往这 <span
class="math inline">\(k\)</span> 个位置放物品的方案数是 <span
class="math inline">\(x^k\)</span>。</p>
<p>还可以这样计数，枚举至少出现一次的物品数量 <span
class="math inline">\(j\)</span>，选出 <span
class="math inline">\(j\)</span> 个，乘上 <span
class="math inline">\(\binom{x}{j}\)</span>。</p>
<p>然后把 <span class="math inline">\(k\)</span> 个位置非空地分配给
<span class="math inline">\(j\)</span> 种物品，乘上第二类斯特林数 <span
class="math inline">\(\begin{Bmatrix}k\\j\end{Bmatrix}\)</span>，但斯特林数计数的是无标号集合，所以还要排列，乘上
<span class="math inline">\(j!\)</span>。</p>
</blockquote>
<p>代回原式 <span class="math display">\[
\begin{aligned}
&amp;\sum_{x=0}^m F(x)x^k\\
=&amp;\sum_{x=0}^mF(x)\sum_{j=0}^k\begin{Bmatrix}k\\j\end{Bmatrix}j!\binom{x}{j}\\
=&amp;\sum_{j=0}^k\begin{Bmatrix}k\\j\end{Bmatrix}j!\color{red}{\sum_{x=0}^m
F(x)\binom{x}{j}}
\end{aligned}
\]</span> 令红色部分为关于 <span class="math inline">\(j\)</span> 的函数
<span class="math inline">\(T(j)\)</span>。</p>
<p>考察 <span class="math inline">\(T(j)\)</span> 的组合意义。</p>
<p>回顾 <span class="math inline">\(F(x)\)</span> 的定义：<span
class="math inline">\(Z(c) = x\)</span> 的合法染色方案 <span
class="math inline">\(c\)</span> 的个数。</p>
<p>乘上 <span
class="math inline">\(\binom{x}{j}\)</span>，也就是从关键点集合已有的颜色中选出
<span class="math inline">\(j\)</span> 个颜色的方案数。</p>
<p>所以 <span class="math inline">\(T(j)\)</span>
的组合意义是：合法的染色方案数，使得 <span
class="math inline">\(j\)</span>
个颜色都至少在某些关键点出现了一次。</p>
<p>我们不关心具体是哪 <span class="math inline">\(j\)</span>
个颜色，所以先除掉一个组合数。 <span class="math display">\[
T(j) = \binom{m}{j}A(j)
\]</span> 现在可以把颜色分成两类：选定的 <span
class="math inline">\(j\)</span> 个颜色，我称之为第一类颜色；和没选定的
<span class="math inline">\(m-j\)</span>
个颜色，我称之为第二类颜色。</p>
<p>其中 <span class="math inline">\(A(j)\)</span>
表示：合法染色方案数，使得每个第一类颜色都至少在某些关键点出现了一次的方案数。</p>
<p>套路地容斥，计数合法染色方案数，使得恰好 <span
class="math inline">\(0\)</span> 个第一类颜色未在任何关键点出现。 <span
class="math display">\[
A(j) = \sum_{i=0}^j(-1)^i\binom{j}{i}h(i)
\]</span> 其中 <span class="math inline">\(h(i)\)</span>
表示合法的染色方案数，使得 <span class="math inline">\(i\)</span>
个第一类颜色均不在任何关键点出现的方案数。</p>
<p>为了求出 <span class="math inline">\(h(i)\)</span>，考虑树形
DP。设</p>
<ul>
<li><span class="math inline">\(f_{u,0}\)</span> 表示节点 <span
class="math inline">\(u\)</span> 放了某个第一类颜色的方案数。</li>
<li><span class="math inline">\(f_{u, 1}\)</span> 表示节点 <span
class="math inline">\(u\)</span> 放了某个第二类颜色的方案数。</li>
</ul>
<p>注意状态的定义，我们还没有确定具体是哪个颜色（还没标号）。</p>
<p>考虑转移，先考虑 <span class="math inline">\(u\)</span>
放某个第二类颜色，这对 <span class="math inline">\(u\)</span>
是否是关键点没有限制。</p>
<p>考察 <span class="math inline">\(u\)</span> 的每个儿子 <span
class="math inline">\(v\)</span>，如果 <span
class="math inline">\(v\)</span>
放第一类颜色，随便哪个都可以，乘上标号，方案数 <span
class="math inline">\(if_{v,0}\cdot\)</span>。</p>
<p>如果 <span class="math inline">\(v\)</span> 放第二类颜色，不能放和
<span class="math inline">\(u\)</span>
一样的，会少一个，乘上标号，方案数 <span
class="math inline">\((m-1-i)f_{v, 1}\)</span>。</p>
<p>发现每个儿子之间互不影响，所以全部乘起来 <span
class="math display">\[
f_{u, 1} = \prod_{v\in \text{child}(u)}\left(if_{v, 0} +
(m-1-i)f_{v,1}\right)
\]</span> 现在考虑 <span class="math inline">\(u\)</span>
放第第一类颜色。如果 <span class="math inline">\(u\)</span>
是关键点，它不能放第一类颜色，<span class="math inline">\(f_{u, 0} =
0\)</span>。</p>
<p>否则，类似地，考察 <span class="math inline">\(u\)</span> 的每个儿子
<span class="math inline">\(v\)</span>。如果 <span
class="math inline">\(v\)</span> 放第一类颜色，不能和 <span
class="math inline">\(u\)</span> 一样，会少一种，乘上标号，方案数 <span
class="math inline">\((i-1)f_{v,0}\)</span>。</p>
<p>如果 <span class="math inline">\(v\)</span>
放第二类颜色，随便哪个都可以，乘上标号，方案数 <span
class="math inline">\((m-i)f_{v,1}\)</span>。</p>
<p>每个儿子之间互不影响，全部乘起来 <span class="math display">\[
f_{u,0} = \prod_{v\in\text{child}(u)}((i-1)f_{v,0}+(m-i)f_{v, 1})
\]</span> 不妨设根为 <span class="math inline">\(1\)</span>，最终 <span
class="math display">\[
h(i) = if_{1,0}+(m-i)f_{1,1}
\]</span> 全部往回代即可求出答案。</p>
<p>答案 <span class="math display">\[
\sum_{j=0}^k\begin{Bmatrix}k\\j\end{Bmatrix}j!\binom{m}{j}\sum_{i=0}^j(-1)^i\binom{j}{i}h(i)
\]</span> 时间复杂度 <span class="math inline">\(\Theta(kn +
k^2)\)</span>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/07/Nov-USACO-Grind/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Shirahane">
      <meta itemprop="description" content="Do something cool.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shirahane's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/11/07/Nov-USACO-Grind/" class="post-title-link" itemprop="url">Nov USACO Grind</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-11-07 17:09:30 / Modified: 17:14:31" itemprop="dateCreated datePublished" datetime="2025-11-07T17:09:30+08:00">2025-11-07</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="usaco24open-the-winning-gene-s"><a
target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P10279">[USACO24OPEN] The
‘Winning’ Gene S</a></h2>
<p>We iterate <span class="math inline">\(L\)</span> from <span
class="math inline">\(1\)</span> to <span
class="math inline">\(n\)</span> and calculate the answer
separately.</p>
<p>Let <span class="math inline">\(S(i, L)\)</span></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/05/Nov-CF-Grind/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Shirahane">
      <meta itemprop="description" content="Do something cool.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shirahane's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/11/05/Nov-CF-Grind/" class="post-title-link" itemprop="url">Nov CF Grind</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-11-05 19:55:14 / Modified: 20:35:26" itemprop="dateCreated datePublished" datetime="2025-11-05T19:55:14+08:00">2025-11-05</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="cf1749d.-counting-arrays"><a
target="_blank" rel="noopener" href="https://codeforces.com/contest/1749/problem/D">CF1749D. Counting
Arrays</a></h2>
<p>Observe that an arbitrary array <span
class="math inline">\(a\)</span> always has a removal sequence of <span
class="math inline">\([1, 1, \dots, 1]\)</span>, for <span
class="math inline">\(\gcd(a_1, 1) = 1\)</span> always holds. Therefore,
as long as there exists an index <span class="math inline">\(2 \le i \le
n, 2\le j \le i, \gcd(a_i, j) = 1\)</span>, we can obtain another
removal sequence by removing the first element until <span
class="math inline">\(a_i\)</span> is shifted to position <span
class="math inline">\(j\)</span>, removing the <span
class="math inline">\(j\)</span>-th element, and removing the first
element until every element is removed.</p>
<p>Thus, the problem reduces to counting the number of arrays of length
from <span class="math inline">\(1\)</span> to <span
class="math inline">\(n\)</span>, where each <span
class="math inline">\(a_i\)</span> is an integer from <span
class="math inline">\(1\)</span> to <span
class="math inline">\(m\)</span>, satisfying the aforementioned
condition.</p>
<p>Consider each length of <span class="math inline">\(a\)</span>
separately.</p>
<p>Assume that the length of <span class="math inline">\(a\)</span> is
<span class="math inline">\(|a|\)</span>, the number of arrays
satisfying the condition equals <span
class="math inline">\(m^{|a|}\)</span> minus the number of arrays <span
class="math inline">\(a\)</span> such that <span class="math display">\[
\forall 2\le i\le |a|, 2\le j \le i,\gcd(a_i, j) &gt; 1
\]</span> Let <span class="math inline">\(T\)</span> denote the number
of arrays satisfying the condition above. To compute <span
class="math inline">\(T\)</span>, we consider each <span
class="math inline">\(a_i\)</span> separately.</p>
<p>Let <span class="math inline">\(c_i\)</span> be the number of
integers which <span class="math inline">\(a_i\)</span> can be. It is
obvious that <span class="math inline">\(c_1 = m\)</span>, because there
is no constraint on it.</p>
<p>Since for every <span class="math inline">\(2\le j\le i, \gcd(a_i, j)
&gt; 1\)</span>, <span class="math inline">\(a_i\)</span> must be a
multiple of every prime number less than or equal to <span
class="math inline">\(i\)</span>. Let <span class="math inline">\(d =
\prod\limits_{2\le p\le i}p\)</span> where <span
class="math inline">\(p\)</span> is a prime number. We have <span
class="math inline">\(c_i =
\left\lfloor\dfrac{m}{d}\right\rfloor\)</span>.</p>
<p>The condition holds for every <span class="math inline">\(2\le i \le
|a|\)</span>, so <span class="math inline">\(T =
\prod\limits_{i=1}^{|a|} c_i\)</span>.</p>
<p>The answer is the sum of <span class="math inline">\(m^{|a|} -
T\)</span> over all <span class="math inline">\(1 \le |a| \le
n\)</span>.</p>
<p>Time complexity: <span class="math inline">\(\Theta(n \log
n)\)</span> due to the use of exponentiation by squaring.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/20/Codeforces-Round-1060-Div-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Shirahane">
      <meta itemprop="description" content="Do something cool.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shirahane's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/20/Codeforces-Round-1060-Div-2/" class="post-title-link" itemprop="url">Codeforces Round 1060 (Div. 2)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-10-20 14:22:32" itemprop="dateCreated datePublished" datetime="2025-10-20T14:22:32+08:00">2025-10-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/19/Mobius-Inversion/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Shirahane">
      <meta itemprop="description" content="Do something cool.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shirahane's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/19/Mobius-Inversion/" class="post-title-link" itemprop="url">Mobius Inversion</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-10-19 22:13:04 / Modified: 22:29:32" itemprop="dateCreated datePublished" datetime="2025-10-19T22:13:04+08:00">2025-10-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="iverson-bracket">Iverson bracket</h2>
<p><span class="math display">\[
[P] =
\left\{\begin{matrix}
1, &amp; \textrm{If P is true;} \\
0, &amp; \textrm{Otherwise.}
\end{matrix}\right.
\]</span></p>
<p>where <span class="math inline">\(P\)</span> is a proposition.</p>
<h2 id="mobius-inversion">Mobius inversion</h2>
<p>$$</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/19/Oct-Joint-Contests/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Shirahane">
      <meta itemprop="description" content="Do something cool.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shirahane's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/19/Oct-Joint-Contests/" class="post-title-link" itemprop="url">Oct Joint Contests</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-10-19 18:14:51" itemprop="dateCreated datePublished" datetime="2025-10-19T18:14:51+08:00">2025-10-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-29 16:59:30" itemprop="dateModified" datetime="2025-10-29T16:59:30+08:00">2025-10-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="noip-round-25"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/contest.php?cid=2319">NOIP
Round 25</a></h2>
<h3 id="problem-a"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/problem.php?cid=2319&amp;pid=0">Problem
A</a></h3>
<blockquote>
<p>Given a tree consisting of <span class="math inline">\(n\)</span>
nodes, numbered from <span class="math inline">\(1\)</span> to <span
class="math inline">\(n\)</span>. Determine the number of permutations
<span class="math inline">\(p\)</span> of length <span
class="math inline">\(n\)</span> satisfying the following condition,
modulo <span class="math inline">\(998244353\)</span>:</p>
<ul>
<li><span class="math inline">\(\forall 1\le x, y \le n\)</span>, if
there is an edge between <span class="math inline">\(x\)</span> and
<span class="math inline">\(y\)</span>, then there should be an edge
between <span class="math inline">\(p_x\)</span> and <span
class="math inline">\(p_y\)</span>.</li>
</ul>
<p><span class="math inline">\(1\le n\le 10^5\)</span>.</p>
</blockquote>
<p>The problem is equivalent to counting the number of trees <span
class="math inline">\(T\)</span> such that <span
class="math inline">\(S\)</span> and <span
class="math inline">\(T\)</span> are isomorphic. In other words, count
the number of automorphisms of <span
class="math inline">\(S\)</span>.</p>
<p><strong>Property <span class="math inline">\(1\)</span>.</strong> A
tree has at most <span class="math inline">\(2\)</span> centroids, and
if there are two, they must be adjacent.</p>
<p><strong>Property <span class="math inline">\(2\)</span>.</strong> In
a tree <span class="math inline">\(T\)</span> isomorphic to <span
class="math inline">\(S\)</span>, the centroids either remain unchanged
or are swapped with each other.</p>
<p>If <span class="math inline">\(S\)</span> has only one centroid, we
run a DFS on <span class="math inline">\(S\)</span>, starting at the
centroid. Assume that the current root is <span
class="math inline">\(u\)</span>.</p>
<p>If there are <span class="math inline">\(c\)</span> children of <span
class="math inline">\(u\)</span> that are isomorphic, they can be
arranged arbitrarily. Hence, we can multiply the answer (initially <span
class="math inline">\(1\)</span>) by <span
class="math inline">\(c!\)</span>. To efficiently check if two trees are
isomorphic, we apply tree hashing, and let <span
class="math inline">\(h(u)\)</span> denote the hash value of the subtree
of <span class="math inline">\(u\)</span>. We use a
<code>std::map</code> to count the number of children sharing the same
hash value.</p>
<p>If <span class="math inline">\(S\)</span> has exactly two centroids
<span class="math inline">\(x, y\)</span>, we run DFS on <span
class="math inline">\(S\)</span>, starting from <span
class="math inline">\(x, y\)</span>, respectively, and compute the
answer in the same way as above. Eventually, if <span
class="math inline">\(h(x) = h(y)\)</span>, it means that <span
class="math inline">\(x\)</span> and <span
class="math inline">\(y\)</span> can be swapped with each other, so we
multiply the answer by <span class="math inline">\(2\)</span>.</p>
<p>Overall complexity: <span class="math inline">\(\Theta(n\log
n)\)</span>.</p>
<h2 id="noi-round-8"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/contest.php?cid=2255">NOI Round
8</a></h2>
<h3 id="problem-a.-lcm"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/problem.php?cid=2255&amp;pid=0">Problem
A. LCM</a></h3>
<blockquote>
<p>Given <span class="math inline">\(n\)</span> sets, each of which
contains positive integers ranged from <span class="math inline">\([1,
m]\)</span>.</p>
<p>From each set, you must choose exactly one element and compute their
<span class="math inline">\(\rm lcm\)</span>.</p>
<p>Find the sum of all possible <span class="math inline">\(\rm
lcm\)</span>, modulo <span class="math inline">\(10^9 + 7\)</span>.</p>
<p><span class="math inline">\(1\le n\le 6, 1 \le m \le 300, 1 \le |S_i|
\le 300\)</span>.</p>
</blockquote>
<p>Let <span class="math inline">\(V = \textrm{lcm}(297,298,299) =
26463294\)</span>.</p>
<p>Apply meet-in-the-middle, and obtain <span
class="math inline">\(c(i)\)</span> and <span
class="math inline">\(d(i)\)</span>, where</p>
<ul>
<li><span class="math inline">\(c(i)\)</span> denotes the number of ways
to choose elements from set <span class="math inline">\(1\)</span> to
set <span
class="math inline">\(\left\lfloor\dfrac{n}{2}\right\rfloor\)</span>
such that their <span class="math inline">\(\rm lcm\)</span> is <span
class="math inline">\(i\)</span>.</li>
<li><span class="math inline">\(d(i)\)</span> denotes the number of ways
to choose elements from set <span
class="math inline">\(\left\lfloor\dfrac{n}{2}\right\rfloor + 1\)</span>
to set <span class="math inline">\(n\)</span> such that their <span
class="math inline">\(\rm lcm\)</span> is <span
class="math inline">\(i\)</span>.</li>
</ul>
<p>Thus, the answer is <span class="math display">\[
\sum_{i=1}^V\sum_{j=1}^Vc(i)d(j)\textrm{lcm}(i, j)
\]</span> We need to compute the formula above efficiently.</p>
<p>Let <span class="math inline">\(a(i) = i\cdot c(i), b(i) = i\cdot
d(i)\)</span>. Since <span class="math inline">\(\textrm{lcm}(i,j) =
\dfrac{ij}{\gcd(i, j)}\)</span>, <span class="math display">\[
\begin{aligned}
&amp; \sum_{i=1}^V\sum_{j=1}^Vc(i)d(j)\textrm{lcm}(i, j) \\
=&amp; \sum_{i=1}^V\sum_{j=1}^V\dfrac{a(i)b(j)}{\gcd(i, j)} \\
=&amp; \sum_{k=1}^V\dfrac{1}{k}\sum_{i=1}^V\sum_{j=1}^Va(i)b(j)[\gcd(i,
j) = k] \\
=&amp; \sum_{k=1}^V\dfrac{1}{k} \sum_{\gcd(i, j) = k}a(i)b(j)
\end{aligned}
\]</span> Note the <span class="math inline">\(\gcd\)</span> convolution
form. Let <span class="math display">\[
h(k) = \sum_{\gcd(i, j) = k} a(i)b(j)
\]</span> Computing <span class="math inline">\(h\)</span> is quite
difficult. Hence, typically, let <span class="math display">\[
\begin{aligned}
H(k) &amp;= \sum_{k | \gcd(i, j)}a(i)b(j) \\
&amp;= \sum_{k | i}a(i)\sum_{k | j}b(j)
\end{aligned}
\]</span> <span class="math inline">\(H(k)\)</span> can be computed in
<span class="math inline">\(\Theta(V\log\log V)\)</span>.</p>
<p>From Mobius inversion, we can imply that <span
class="math display">\[
H(k) = \sum_{k | d} h(d) \Leftrightarrow h(k) = \sum_{k | d}
H(d)\mu\left(\dfrac{d}{k}\right)
\]</span> Similarly, <span class="math inline">\(h(k)\)</span> can now
be computed in <span class="math inline">\(\Theta(V\log\log
V)\)</span>.</p>
<p>Overall time complexity: <span class="math inline">\(\Theta(V\log\log
V)\)</span>.</p>
<h2 id="noip-round-26"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/contest.php?cid=2320">NOIP
Round 26</a></h2>
<h3 id="problem-a.-hope"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/problem.php?cid=2320&amp;pid=0">Problem
A. Hope</a></h3>
<blockquote>
<p>There are <span class="math inline">\(n\)</span> main buildings
numbered <span class="math inline">\(1,\ldots,n\)</span> arranged on a
circle with circumference <span class="math inline">\(C\)</span>. The
<span class="math inline">\(i\)</span>-th building is located at
position <span class="math inline">\(L_i(0\le L_i&lt;C)\)</span> along
the circle and has a height of <span class="math inline">\(h_i\)</span>.
There is one more building, the student center, located at the center of
the circle whose height is not decided yet.</p>
<p>You need to connect the <span class="math inline">\(n+1\)</span>
buildings with some straight tunnels such that any building can reach
any other building using these tunnels. A tunnel can be modeled as a
line segment (in a <span class="math inline">\(2\)</span>-dimensional
plane) connecting two of the buildings. All these tunnels will be at the
same elevation, so their corresponding line segments must not intersect
(except at endpoints). For some reason, the cost of constructing a
tunnel between two buildings with heights <span
class="math inline">\(h_1\)</span> and <span
class="math inline">\(h_2\)</span> is equal to <span
class="math inline">\(|h_1−h_2|\)</span>.</p>
<p>Given <span class="math inline">\(q\)</span> queries <span
class="math inline">\(m_1, \ldots, m_q\)</span>, where you have to
determine the minimum possible cost to connect all the buildings if the
student center has a height of <span
class="math inline">\(m_i\)</span>.</p>
<p><span class="math inline">\(1\le n\le 500, 1\le q\le10^6,1\le C \le
10^9\)</span>.</p>
<p>It is guaranteed that there do not exist two diametrically opposite
buildings.</p>
</blockquote>
<p>First, let’s sort the buildings by <span
class="math inline">\(L_i\)</span>. We need to connect <span
class="math inline">\(n\)</span> non-intersecting edges to form a tree
connecting <span class="math inline">\(n+1\)</span> buildings.</p>
<p>Consider the case where we removed the center of the circle.</p>
<p>Typically, we break the cycle into a chain. In particular, let <span
class="math inline">\(L_{i + n} = L_{i} + C, h_{i + n} = h_i\)</span>
for <span class="math inline">\(1 \le i \le n\)</span>.</p>
<p>Then, we apply a DP approach.</p>
<p>Let <span class="math inline">\(f_{l, r}\)</span> denote the minimum
cost to connect buildings in <span class="math inline">\([l,
r]\)</span>, using only internal edges. There are two cases:</p>
<ul>
<li><p>We do not connect an edge between <span
class="math inline">\(l\)</span> and <span
class="math inline">\(r\)</span>. Thus, there must exist a building
<span class="math inline">\(k \in (l, r)\)</span>, such that both
buildings in <span class="math inline">\([l, k]\)</span> and buildings
in <span class="math inline">\([k, r]\)</span> are connected. <span
class="math display">\[
f_{l, r} = \min_{l&lt;k&lt;r}f_{l, k} + f_{k, r}
\]</span></p></li>
<li><p>We connect an edge between <span class="math inline">\(l\)</span>
and <span class="math inline">\(r\)</span>. Since <span
class="math inline">\(l\)</span> and <span
class="math inline">\(r\)</span> are connected by the edge, there must
exist a building <span class="math inline">\(k \in [l, r)\)</span>, such
that both buildings in <span class="math inline">\([l, k]\)</span> and
buildings in <span class="math inline">\([k + 1, r]\)</span> are
connected.</p></li>
</ul>
<p><span class="math display">\[
f_{l, r} = \min_{l \le k &lt; r}f_{l, k} + f_{k + 1, r} + |h_l - h_r|
\]</span></p>
<p>Also, for the sake of convenience, we would like that the innermost
edges form a convex polygon, so that every building can be connected to
the center without intersecting with other edges. Hence, if the length
of the arc between <span class="math inline">\(l\)</span> and <span
class="math inline">\(r\)</span> exceeds <span
class="math inline">\(\dfrac{C}{2}\)</span>, we will not consider
connecting them.</p>
<p><img src="/uploads/screen-shot-2025-10-23-141245.png" /></p>
<p>The red line in the picture represents where we break the circle into
a chain.</p>
<p>Clearly, the constraints we add will not affect the correctness of
the DP.</p>
<p>Now, we need to replace some edges to connect the center of the
circle. Let the height of the central building be <span
class="math inline">\(x\)</span>. Assume that the central building is
connected to buildings <span class="math inline">\(a_1, a_2, \cdots
a_k\)</span>, in clockwise order.</p>
<p><strong>Key observation: In an optimal solution, the central building
will be connected to at most <span class="math inline">\(2\)</span>
buildings, one higher than <span class="math inline">\(x\)</span> and
one lower than <span class="math inline">\(x\)</span>.</strong></p>
<p><strong>Proof.</strong> Consider the central building is connected to
two buildings <span class="math inline">\(a_i\)</span> and <span
class="math inline">\(a_{i+1}\)</span>, where <span
class="math inline">\(h_{a_i}, h_{a_{i+1}} \ge x\)</span>. We always
have <span class="math display">\[
|h_{a_i} - x| + |h_{a_{i+1}} - x| \ge |h_{a_i} - h_{a_{i+1}}|
\]</span> Hence, we can replace one of the edge with an edge between
<span class="math inline">\(a_i\)</span> and <span
class="math inline">\(a_{i+1}\)</span>, which will not make the answer
worse.</p>
<p>It can be shown that the replacement will not increase restrictions
on connectivity, that is, if a certain edge between <span
class="math inline">\(u\)</span> and <span
class="math inline">\(v\)</span> cannot be connected before, then it may
be able to be connected after the replacement. Similarly, if a certain
edge between <span class="math inline">\(u\)</span> and <span
class="math inline">\(v\)</span> can be connected before, the
replacement will not make it unable to be connected.</p>
<p><img src="/uploads/screen-shot20251022-193448.png" /></p>
<p>The case where <span class="math inline">\(h_{a_i}, h_{a_{i+1}} \le
x\)</span> is symmetric, so the same conclusion applies.</p>
<p>Hence, if we sequentially proceed the replacement above, eventually
there will be at most one building whose height <span
class="math inline">\(\ge x\)</span> and at most one building whose
height <span class="math inline">\(\le x\)</span>.</p>
<p>Therefore, for a fixed <span class="math inline">\(x\)</span>, there
are only two ways to connect the central building optimally. Assume that
we break the circle into a chain, starting at <span
class="math inline">\(l\)</span> and ends at <span
class="math inline">\(r = l + n - 1\)</span>.</p>
<ul>
<li><p>The central building is only connected to one building <span
class="math inline">\(k\)</span>. The cost is <span
class="math display">\[
f_{l, k} + f_{k, r} + |h_k - x|
\]</span></p></li>
<li><p>The central building is connected to exactly two buildings <span
class="math inline">\(i\)</span> and <span
class="math inline">\(j\)</span>. The cost is <span
class="math display">\[
\begin{aligned}
&amp; f_{l, i} + f_{j, r} + \min(f_{i+1,j}, f_{i, j - 1}) + |h_i - x| +
|h_j - x|\\
= &amp;f_{l, i} + f_{j, r} + \min(f_{i + 1, j}, f_{i, j - 1}) + |h_i -
h_j|
\end{aligned}
\]</span></p></li>
</ul>
<p>The DP approach runs in <span
class="math inline">\(\Theta(n^3)\)</span>, and for a fixed <span
class="math inline">\(x\)</span>, computing the answer is <span
class="math inline">\(\Theta(n^3)\)</span>. Thus, the overall complexity
for <span class="math inline">\(q\)</span> queries is <span
class="math inline">\(\Theta(qn^3)\)</span>, which needs optimizing.</p>
<p>Note that, for a building <span class="math inline">\(k\)</span>,
assuming that <span class="math inline">\(x \le h_k\)</span>, then the
cost is <span class="math inline">\(f_{l, k} + f_{k, r} + h_k -
x\)</span>, which shows that <span class="math inline">\(f_{l, k} +
f_{k, r} + h_k\)</span> can contribute to each <span
class="math inline">\(x \in [0, h_k]\)</span>. I call this kind of
contribution type <span class="math inline">\(0\)</span>.</p>
<p>Similarly, assuming that <span class="math inline">\(x \ge
h_k\)</span>, <span class="math inline">\(f_{l, k} + f_{k, r} -
h_k\)</span> can contribute to each <span class="math inline">\(x &gt;
h_k\)</span>. I call this kind of contribution type <span
class="math inline">\(1\)</span>.</p>
<p>For a pair <span class="math inline">\((i, j)\)</span>, then <span
class="math inline">\(f_{l, i} + f_{j, r} + \min(f_{i + 1, j}, f_{i, j -
1}) + |h_i - h_j|\)</span> can contribute to each <span
class="math inline">\(x\in [\min(h_i, h_j), \max(h_i, h_j)]\)</span>. I
call this kind of contribution type <span
class="math inline">\(2\)</span>.</p>
<p>For each <span class="math inline">\(x\)</span>, maintain the minimum
contributions of each type respectively, represented by <span
class="math inline">\(c_0,c_1, c_2\)</span>. We can compute the answer
to <span class="math inline">\(x\)</span> easily: <span
class="math display">\[
\min(c_0 - x, c_1 + x, c_2)
\]</span> Maintain a segment tree on range, supporting range updates and
point queries. Since the range of <span class="math inline">\(h\)</span>
and <span class="math inline">\(x\)</span> are large, discretization is
required.</p>
<p>Overall complexity: <span class="math inline">\(\Theta(n^3 +
n^2\log(n + q) + q\log n)\)</span>.</p>
<h2 id="noip-round-27"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/contest.php?cid=2325">NOIP
Round 27</a></h2>
<h3 id="problem-a.-interval"><a
target="_blank" rel="noopener" href="http://192.168.102.138/JudgeOnline/problem.php?cid=2325&amp;pid=0">Problem
A. interval</a></h3>
<blockquote>
<p>Given an array <span class="math inline">\(a\)</span> of length <span
class="math inline">\(n\)</span> consisting of positive integers.</p>
<p>Define <span class="math display">\[
f(l, r) = \left(\max_{i=l}^r a_i\right) \times \left(\min_{i=l}^r
a_i\right)
\]</span> Find the sum of the <span class="math inline">\(k\)</span>
largest <span class="math inline">\(f(l, r)\)</span> overall <span
class="math inline">\(1\le l \le r \le n\)</span>.</p>
<p><span class="math inline">\(1\le n\le 5\cdot 10^5, 1 \le k \le
\dfrac{n(n+1)}{2}, 1\le a_i \le 10^9\)</span>.</p>
</blockquote>
<p>Let <span class="math inline">\(m\)</span> be the largest value such
that <span class="math display">\[
\#\{1\le l\le r \le n, f(l, r) \ge m\} \ge k
\]</span> Let <span class="math inline">\(\#\{1\le l\le r \le n, f(l, r)
\ge m\} = c\)</span>, then the answer equals <span
class="math display">\[
\sum_{1\le l\le r \le n, f(l, r) \ge m} f(l, r) - (c - k)m
\]</span> It’s obvious that <span class="math inline">\(m\)</span> is
monotonic, so we perform binary search on <span
class="math inline">\(m\)</span>. Assume that we need to determine the
value of <span class="math display">\[
\#\{1\le l\le r \le n, f(l, r) \ge x\}
\]</span> Let</p>
<ul>
<li><span class="math inline">\(L_i\)</span> denote the nearest index
<span class="math inline">\(j\)</span> to the left of <span
class="math inline">\(i\)</span> such that <span
class="math inline">\(a_j &gt; a_i\)</span>. If such <span
class="math inline">\(j\)</span> does not exist, set <span
class="math inline">\(L_i\)</span> to <span
class="math inline">\(0\)</span>.</li>
<li><span class="math inline">\(R_i\)</span> denote the nearest index
<span class="math inline">\(j\)</span> to the right of <span
class="math inline">\(i\)</span> such that <span
class="math inline">\(a_j \ge a_i\)</span>. If such <span
class="math inline">\(j\)</span> does not exist, set <span
class="math inline">\(R_i\)</span> to <span class="math inline">\(n +
1\)</span>.</li>
</ul>
<p>Hence, for each segment <span class="math inline">\([l, r]\)</span>
where <span class="math inline">\(L_p&lt; l \le p \le r &lt;
R_p\)</span>, the value of <span class="math inline">\(\max\limits_{L_p
&lt; i &lt; R_p}a_i = a_p\)</span>, which is fixed. We will iterate one
of the endpoints of the segment.</p>
<p>Assume that <span class="math inline">\(p - L_p &lt; R_p -
p\)</span>, we iterate each <span class="math inline">\(i\)</span> from
<span class="math inline">\(p\)</span> down to <span
class="math inline">\(L_p + 1\)</span>. For a fixed endpoint <span
class="math inline">\(i\)</span>, we need to find another endpoint <span
class="math inline">\(j \in [p, R_p)\)</span> such that <span
class="math inline">\(a_p \cdot \min\limits_{i\le k\le j}a_k \ge
x\)</span>.</p>
<p>If <span class="math inline">\(\left(\min\limits_{i \le j \le p}
a_j\right) \cdot a_p &lt; x\)</span>, clearly whatever value <span
class="math inline">\(j\)</span> equals, <span class="math inline">\(a_p
\cdot \min\limits_{i\le k\le j}a_k &lt; x\)</span> always holds.</p>
<p>Otherwise, there may exist some <span
class="math inline">\(j\)</span>’s satisfying the condition. <span
class="math display">\[
a_p \cdot \min\limits_{i\le k\le j}a_k \ge x \Leftrightarrow
\min\limits_{i\le k\le j}a_k \ge \color{red}\left\lceil \dfrac{x}{a_p}
\right\rceil
\]</span> where the red term is fixed.</p>
<p>Note that <span class="math inline">\(\min\limits_{i \le k \le j}
a_k\)</span> is <strong>non-increasing</strong> as <span
class="math inline">\(j\)</span> increases. Thus, we perform binary
search and find the largest such <span class="math inline">\(j\)</span>.
Then all segments <span class="math inline">\([l, r]\)</span> where
<span class="math inline">\(l = i, r \in [p, j]\)</span> satisfy the
condition, so we add <span class="math inline">\(j - p + 1\)</span> to
the count.</p>
<p>The case where <span class="math inline">\(p - L_p \ge R_p -
p\)</span> is symmetric, so a similar approach applies.</p>
<p>We have determined the value of <span
class="math inline">\(m\)</span>. Now we need to compute <span
class="math display">\[
\sum_{1\le l\le r \le n, f(l, r) \ge m} f(l, r) - (c - k)m
\]</span> Similarly, we fix the maximum <span
class="math inline">\(a_p\)</span>, iterate left point <span
class="math inline">\(i\)</span> (or right endpoint symmetrically) and
find the largest such <span class="math inline">\(j\)</span>. We need to
compute <span class="math display">\[
G(i, p, j) = \sum_{k=p}^j \min_{t=i}^k a_t
\]</span> In order to compute efficiently, let’s consider prefix
sums.</p>
<p>Define <span class="math display">\[
g_i = G(i, i, n) = \sum_{k=i}^n \min_{t=i}^k a_t
\]</span> We have <span class="math display">\[
G(i, p, j) = G(i, i, j) - G(i, i, p - 1)
\]</span> so we can focus on the computation of <span
class="math inline">\(G(i, i, r)\)</span>.</p>
<p>Let <span class="math inline">\(mn = \min\limits_{i \le k \le r}
a_k\)</span>. We perform binary search to find the nearest index <span
class="math inline">\(j\)</span> to the right of <span
class="math inline">\(r\)</span> such that <span
class="math inline">\(a_j &lt; mn\)</span>. Thus <span
class="math display">\[
G(i, i, r) = g_i - g_j - (j - 1 - i)mn
\]</span> where <span class="math inline">\(g\)</span> can be obtained
using a monotonic stack.</p>
<p>The case where <span class="math inline">\(p - L_p \ge R_p -
p\)</span> is symmetric, so a similar approach applies.</p>
<p>Overall complexity: <span class="math inline">\(\Theta(n\log V \log n
+ n\log^2 n)\)</span>, where <span class="math inline">\(V\)</span>
denotes the range of the elements.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/14/Oct-CF-Grind/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Shirahane">
      <meta itemprop="description" content="Do something cool.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shirahane's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/14/Oct-CF-Grind/" class="post-title-link" itemprop="url">Oct CF Grind</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-10-14 20:38:35" itemprop="dateCreated datePublished" datetime="2025-10-14T20:38:35+08:00">2025-10-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-10-31 14:10:04" itemprop="dateModified" datetime="2025-10-31T14:10:04+08:00">2025-10-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="cf2061e"><a
target="_blank" rel="noopener" href="https://codeforces.com/problemset/problem/2061/E">CF2061E</a></h2>
<blockquote>
<p>Given an array <span class="math inline">\(a\)</span> of length <span
class="math inline">\(n\)</span> and an array <span
class="math inline">\(b\)</span> of length <span
class="math inline">\(m\color{red}({m\le10})\)</span>.</p>
<p>Perform at most <span class="math inline">\(k\)</span> operations in
order to minimize <span class="math inline">\(\sum\limits_{i=1}^n
a_i\)</span>.</p>
<p>In each operation, choose two indices <span class="math inline">\(i
\in [1,n]\)</span> and <span class="math inline">\(j \in [1, m]\)</span>
and apply <span class="math inline">\(a_i \leftarrow a_i \ \&amp; \
b_j\)</span>.</p>
</blockquote>
<p>My first idea is to iterate from the highest bit to the lowest bit
and greedily set the current bit to <span
class="math inline">\(0\)</span>. However it can be easily hacked by the
following: <span class="math display">\[
\begin{aligned}&amp; n = 1, m = 3,k = 2 \\
&amp; a = [1111_2] \\
&amp; b = [11_2, 1010_2, 101_2]
\end{aligned}
\]</span> The correct answer is <span class="math inline">\(0\)</span>
(apply <span class="math inline">\(1010_2\)</span> and <span
class="math inline">\(101_2\)</span>)，but the greedy solution applies
<span class="math inline">\(11_2\)</span>. Since the greedy solution
fails, we should consider DP, which effectively compresses states.</p>
<p>Observe that a <span class="math inline">\(b_j\)</span> will not be
applied to a <span class="math inline">\(a_i\)</span> twice since <span
class="math inline">\(a_i \ \&amp; \ b_j = a \ \&amp;\ b_j\ \&amp;\
b_j\)</span>.</p>
<p>Since <span class="math inline">\(m \le 10\)</span>, let <span
class="math inline">\(f_{i, j}\)</span> denote the minimum number that
can be obtained by applying <span class="math inline">\(j\)</span>
operations to <span class="math inline">\(a_i\)</span>, which can be
compute straightforwardly using bitmask DP.</p>
<p>Now we need to assign <span class="math inline">\(c_i\)</span> to
each <span class="math inline">\(a_i\)</span> where the sum of <span
class="math inline">\(c_i\)</span> equals <span
class="math inline">\(k\)</span> and minimize <span
class="math display">\[
\begin{aligned}
\sum_{i=1}^n f_{i, c_i}
\end{aligned}
\]</span> <strong>Key observation: <span
class="math inline">\(f_i\)</span> is a convex sequence i.e. <span
class="math inline">\(2f_{i, j} \le f_{i, j - 1} + f_{i, j + 1}\)</span>
always holds.</strong></p>
<p>This can be guessed according to marginal utility, because the
operations apply first set higher bits to <span
class="math inline">\(0\)</span> and decrease the sum more, while the
operations apply subsequently set lower bits to <span
class="math inline">\(0\)</span> and decrease the sum less.</p>
<blockquote>
<p><strong>Proof</strong>: Let <span class="math inline">\(S\)</span>
denote the set of operations that obtain <span
class="math inline">\(f_{i,j-1}\)</span>. Similarly, let <span
class="math inline">\(T\)</span> denote the set of operations that
obtain <span class="math inline">\(f_{i, j + 1}\)</span>. Suppose the
<span class="math inline">\(w\)</span>-th bit is the highest bit where
<span class="math inline">\(f_{i,j-1}\)</span> and <span
class="math inline">\(f_{i,j+1}\)</span> differ.</p>
<p>There must exist a certain operation <span class="math inline">\(u
\in T \setminus S\)</span> which can set the <span
class="math inline">\(w\)</span>-th bit of <span
class="math inline">\(f_{i,j-1}\)</span> to <span
class="math inline">\(0\)</span>. <span class="math display">\[
f_{i,j-1} - 2^w \ge f_{i,j}
\]</span> Additionally, the highest bit where <span
class="math inline">\(f_{i,j}\)</span> and <span
class="math inline">\(f_{i,j+1}\)</span> differ <span
class="math inline">\(&lt; w\)</span> <span class="math display">\[
f_{i,j}-f_{i,j+1}\le2^w
\]</span> By combining two inequalities we can imply that <span
class="math display">\[
2f_{i,j}\le f_{i,j-1}+f_{i, j+1}
\]</span></p>
</blockquote>
<p>With the key observation, we define the difference array <span
class="math inline">\(d_{i, j} = f_{i,j} - f_{i,j+1}\)</span> of each
<span class="math inline">\(f_i\)</span> and we can imply that <span
class="math inline">\(d_i\)</span> is <strong>non-increasing</strong>
from the definition of convex function.</p>
<p>How can we characterize applying <span
class="math inline">\(c_i\)</span> operations to <span
class="math inline">\(a_i\)</span> in terms of the difference array?</p>
<p>We have <span class="math inline">\(\sum\limits_{j=0}^{c_i-1} d_{i,j}
= f_{i, 0} - f_{i, c_i} = a_{i} - f_{i, c_i}\)</span>, that is, the sum
of the first <span class="math inline">\(c_i\)</span> terms of <span
class="math inline">\(d_i\)</span> equals the maximum decreased value of
<span class="math inline">\(a_i\)</span>. Therefore, we need to maximize
the decreased value. Since the difference array is non-increasing, <span
class="math inline">\(d_{i,j-1}\)</span> will definitely be chosen if
<span class="math inline">\(d_{i, j}\)</span> is chosen, which naturally
satisfies the requirement of choosing a prefix.</p>
<p>Thus, we can get the answer by sorting all <span
class="math inline">\(d_{i,j}\)</span> values, taking the first <span
class="math inline">\(k\)</span> largest ones, and subtracting them from
<span class="math inline">\(\sum\limits_{i=1}^na_i\)</span>.</p>
<p>Overall complexity: <span
class="math inline">\(\Theta(2^mn).\)</span></p>
<h2 id="cf2089b1"><a
target="_blank" rel="noopener" href="https://codeforces.com/problemset/problem/2089/B1">CF2089B1</a></h2>
<blockquote>
<p>Given two integer array <span class="math inline">\(a, b\)</span>,
both of which contain <span class="math inline">\(n\)</span> elements
and is <span class="math inline">\(0\)</span>-based. It is guaranteed
that the sum of all elements in <span class="math inline">\(a\)</span>
does not exceed the sum of all elements in <span
class="math inline">\(b\)</span>.</p>
<p>The following three operations are performed sequentially on <span
class="math inline">\(a\)</span> and <span
class="math inline">\(b\)</span>:</p>
<ol type="1">
<li>For each <span class="math inline">\(0\le i&lt;n\)</span>: <span
class="math inline">\(t:=\min(a_i,b_i),a_i:=a_i−t,b_i:=b_i−t\)</span>;</li>
<li>For each <span class="math inline">\(0\le i&lt;n\)</span>: <span
class="math inline">\(c_i:=a_{(i−1)\bmod \ n}\)</span>;</li>
<li>For each <span class="math inline">\(0≤i&lt;n\)</span>: <span
class="math inline">\(a_i:=c_i\)</span>;</li>
</ol>
<p>(The operation 2 and 3 are equivalent to the right-shift of <span
class="math inline">\(a\)</span>.)</p>
<p>Find out the minimum number of rounds required for all elements in
<span class="math inline">\(a\)</span> become equal to <span
class="math inline">\(0\)</span>.</p>
</blockquote>
<p>Let <span class="math inline">\(d_i\)</span> denote the minimum
number of rounds required for <span class="math inline">\(a_i\)</span>
become equal to <span class="math inline">\(0\)</span>, by
right-shifting <span class="math inline">\(a\)</span>. The answer is
<span class="math inline">\(\max d_i\)</span>.</p>
<p>Typically, break the cycle into a chain(i.e. let <span
class="math inline">\(a_{i+n} = a_i, b_{i+n}=b_i\)</span>).</p>
<p><strong>Key transformation</strong>: construct a parenthesis sequence
<span class="math inline">\(s\)</span> by concatenating <span
class="math inline">\(a_0\)</span> left parentheses, <span
class="math inline">\(b_0\)</span> right parentheses, …, <span
class="math inline">\(a_{2n-1}\)</span> left parentheses, <span
class="math inline">\(b_{2n-1}\)</span> right parentheses. Then, the
operation in the original problem corresponds to the process of matching
parentheses in <span class="math inline">\(s\)</span>.</p>
<p>Typically, let <span class="math inline">\(c_i =
\sum\limits_{j=0}^i(a_j - b_j)\)</span>. Define <span
class="math inline">\(p_i\)</span> the smallest index satisfying <span
class="math inline">\(p_i \ge i\)</span> and <span
class="math inline">\(c_{p_i} \le c_i\)</span>. Then <span
class="math inline">\(d_i = p_i - i\)</span>.</p>
<p><span class="math inline">\(p_i\)</span> can be computed using a
monotonic stack.</p>
<p>Overall complexity: <span
class="math inline">\(\Theta(n)\)</span>.</p>
<h2 id="cf2085d"><a
target="_blank" rel="noopener" href="https://codeforces.com/problemset/problem/2085/D">CF2085D</a></h2>
<blockquote>
<p>Given an array <span class="math inline">\(a\)</span> of length <span
class="math inline">\(n\)</span>, an array <span
class="math inline">\(d\)</span> of length <span
class="math inline">\(n\)</span>, and an integer <span
class="math inline">\(k\)</span>.</p>
<p>Initially, set the counter <span class="math inline">\(r = 0\)</span>
and the value <span class="math inline">\(c = 0\)</span>. Iterate <span
class="math inline">\(i\)</span> from <span
class="math inline">\(1\)</span> to <span
class="math inline">\(n\)</span> and perform <strong>one</strong> of the
following operations:</p>
<ul>
<li>Increment <span class="math inline">\(r\)</span> by <span
class="math inline">\(k\)</span>, and then increment <span
class="math inline">\(c\)</span> by <span
class="math inline">\(d_i\)</span>;</li>
<li>Decrement <span class="math inline">\(r\)</span> by <span
class="math inline">\(1\)</span>;</li>
<li>Do nothing, and the value of <span class="math inline">\(r\)</span>
and <span class="math inline">\(c\)</span> remain unchanged.</li>
</ul>
<p>After <span class="math inline">\(n\)</span> operations, the value of
<span class="math inline">\(r\)</span> must be <span
class="math inline">\(0\)</span>. Find out the maximum value of <span
class="math inline">\(c\)</span> that can be obtained.</p>
</blockquote>
<p>I came up with an <span class="math inline">\(\Theta(n^2)\)</span> DP
approach at first, and I found it impossible to optimize it.</p>
<p>Perform the operations backwards.</p>
<p>Initially, <span class="math inline">\(r = c = 0\)</span>, and the
original operations correspond to the following operations,
respectively:</p>
<ul>
<li>Set <span class="math inline">\(r\)</span> to <span
class="math inline">\(r - k\)</span>, and then set <span
class="math inline">\(c\)</span> to <span class="math inline">\(c +
d_i\)</span>;</li>
<li>Set <span class="math inline">\(r\)</span> to <span
class="math inline">\(r + 1\)</span>;</li>
<li>Do nothing.</li>
</ul>
<p>Note that <span class="math inline">\(r \ge 0\)</span> must hold
constantly during the process.</p>
<p>Consider a regret greedy approach. When processing <span
class="math inline">\(i\)</span>, we directly take <span
class="math inline">\(d_i\)</span> and set <span
class="math inline">\(r\)</span> to <span class="math inline">\(r -
k\)</span>.</p>
<p>However, if <span class="math inline">\(r &lt; 0\)</span> after the
operation, we will replace the previously performed operation 1 with the
least <span class="math inline">\(d\)</span> with operation 2, and add
<span class="math inline">\(k+1\)</span> to <span
class="math inline">\(r\)</span>. Such an operation can be found using a
heap.</p>
<p>Overall complexity: <span class="math inline">\(\Theta(n\log
n)\)</span>.</p>
<h2 id="cf2082c"><a
target="_blank" rel="noopener" href="https://codeforces.com/problemset/problem/2082/C">CF2082C</a></h2>
<blockquote>
<p>Given a binary string of length <span
class="math inline">\(n\)</span>, corresponding to an integer <span
class="math inline">\(x\)</span>.</p>
<p>There are two types of operations.</p>
<ul>
<li>Replace <span class="math inline">\(x\)</span> with <span
class="math inline">\(\left\lceil \dfrac{x}{2}
\right\rceil\)</span>;</li>
<li>Replace <span class="math inline">\(x\)</span> with <span
class="math inline">\(\left\lfloor \dfrac{x}{2}
\right\rfloor\)</span>.</li>
</ul>
<p>Perform the operations until <span class="math inline">\(x\)</span>
becomes <span class="math inline">\(1\)</span>. Each time, each of the
operations will be performed with possibility <span
class="math inline">\(\dfrac{1}{2}\)</span>, independently.</p>
<p>Determine the expected number of operations to make <span
class="math inline">\(x\)</span> equal to <span
class="math inline">\(1\)</span>.</p>
</blockquote>
<p>Replacing <span class="math inline">\(x\)</span> with <span
class="math inline">\(\left\lceil \dfrac{x}{2} \right\rceil\)</span> is
equivalent to replacing it with <span class="math inline">\(\left\lfloor
\dfrac{x+1}{2} \right\rfloor\)</span>.</p>
<p>Observe that the number of operations required is either <span
class="math inline">\(n-1\)</span> or <span
class="math inline">\(n\)</span>, depending on whether there is a carry
at the <span class="math inline">\((n-1)\)</span>-th bit.</p>
<p>Thus, let <span class="math inline">\(f_i\)</span> denote the
probability with which there is a carry at the <span
class="math inline">\(i\)</span>-th bit.</p>
<p>If <span class="math inline">\(s_i = 0\)</span>, the <span
class="math inline">\(i\)</span>-th bit carries iff the <span
class="math inline">\((i-1)\)</span>-th bit carries and rounding up is
applied to the <span class="math inline">\(i\)</span>-th bit. Hence
<span class="math display">\[
f_i = \dfrac{1}{2}f_{i-1}(s_i = 0)
\]</span> If <span class="math inline">\(s_i = 0\)</span>, there are two
cases.</p>
<p>If the <span class="math inline">\((i-1)\)</span>-th bit carries,
then <span class="math inline">\(i\)</span>-th bit will definitely
carry.</p>
<p>If the <span class="math inline">\((i-1)\)</span> does not carry,
then the <span class="math inline">\(i\)</span>-th bit carries iff
rounding up is applied. Hence <span class="math display">\[
f_i = \dfrac{1}{2}(1-f_{i-1}) + f_{i-1}(s_i = 1)
\]</span> In summary: <span class="math display">\[
\left\{\begin{aligned}
&amp; f_i = \dfrac{1}{2}f_{i-1}, &amp; s_i = 0 \\
&amp; f_i = \dfrac{1}{2}(1-f_{i-1}) + f_{i-1}, &amp;s_i = 1
\end{aligned}\right.
\]</span> The answer is <span class="math display">\[
nf_{n-1} + (n-1)(1-f_{n-1})
\]</span> i.e. <span class="math display">\[
\boxed{n-1+f_{n-1}}
\]</span></p>
<p>Overall complexity: <span
class="math inline">\(\Theta(n)\)</span>.</p>
<h2 id="cf2057d"><a
target="_blank" rel="noopener" href="https://codeforces.com/problemset/problem/2057/D">CF2057D</a></h2>
<blockquote>
<p>Given an integer array <span class="math inline">\(a\)</span> of
length <span class="math inline">\(n\)</span>. Define the value of <span
class="math inline">\(a\)</span> as the maximum <span
class="math inline">\(f(l, r)\)</span> overall <span
class="math inline">\(1\le l \le r \le n\)</span> where <span
class="math display">\[
f(l, r) = \max_{i=l}^r a_i - \min_{i=l}^r -(r-l)
\]</span> There are also <span class="math inline">\(q\)</span>
modification <span class="math inline">\((p, x)\)</span>, representing
setting <span class="math inline">\(a_p\)</span> to <span
class="math inline">\(x\)</span>.</p>
<p>Determine the value of <span class="math inline">\(a\)</span>
initially, and after each modification.</p>
</blockquote>
<p>It’s obvious that the maximum and the minimum are located at either
<span class="math inline">\(l\)</span> or <span
class="math inline">\(r\)</span>.</p>
<p>Assume that the minimum is located at <span
class="math inline">\(l\)</span>, and the maximum is located at <span
class="math inline">\(r\)</span>. Then we have <span
class="math display">\[
f(l, r) = a_r - a_l - (r - l)
\]</span> i.e. <span class="math display">\[
f(l, r) = (a_r - r) - (a_l - l)
\]</span> The two terms are independent. To maximize <span
class="math inline">\(f(l, r)\)</span>, we will choose the maximum <span
class="math inline">\(a_r - r\)</span> and the minimum <span
class="math inline">\(a_l - l\)</span>.</p>
<p>Maintain a segment tree, nodes of which store <span
class="math inline">\(mx, mn, ans\)</span>, representing the maximum
<span class="math inline">\(a_i - i\)</span>, the minimum <span
class="math inline">\(a_i - i\)</span>, the answer of the corresponding
segment, respectively. <span class="math inline">\(ans\)</span> can be
obtained by choosing the maximum value among the answer of the left
child, the answer of the right child, and the <span
class="math inline">\(mx\)</span> of the right child minus the <span
class="math inline">\(mn\)</span> of the left child.</p>
<p>Overall complexity: <span class="math inline">\(\Theta(q\log
n)\)</span>.</p>
<h2 id="cf2050g"><a
target="_blank" rel="noopener" href="https://codeforces.com/problemset/problem/2050/G">CF2050G</a></h2>
<blockquote>
<p>Given a tree consisting of <span class="math inline">\(n\)</span>
nodes. Select two vertices <span class="math inline">\(a, b\)</span>
(possibly the same) and remove all vertices on path <span
class="math inline">\((a,b)\)</span> (including <span
class="math inline">\(a\)</span> and <span
class="math inline">\(b\)</span>).</p>
<p>Determine the maximum number of connected components that can be
obtained after the removal.</p>
</blockquote>
<p>Let <span class="math inline">\(k\)</span> denote the length of path
<span class="math inline">\((a, b)\)</span>, and <span
class="math inline">\(S\)</span> denote the set containing all vertices
on path <span class="math inline">\((a, b)\)</span>. The number of
connected components after the removal is <span class="math display">\[
\sum_{u \in S} \deg_u - 2k
\]</span> Thus, we apply a DP approach.</p>
<p>Let <span class="math inline">\(f_{u, 0}\)</span> denote the maximum
number of connected components that can be obtained by removing a path
<span class="math inline">\((v, u)\)</span>, where <span
class="math inline">\(v\)</span> is in the subtree of <span
class="math inline">\(u\)</span>.</p>
<p>Let <span class="math inline">\(f_{u, 1}\)</span> denote the maximum
number of connected components that can be obtained by removing a path
<span class="math inline">\((v_1, v_2)\)</span>, where both of <span
class="math inline">\(v_1, v_2\)</span> are in the subtree of <span
class="math inline">\(u\)</span> and <span
class="math inline">\(\textrm{LCA}(v_1, v_2) = u\)</span> (This
guarantees <span class="math inline">\((v_1, v_2)\)</span> is a simple
path passing <span class="math inline">\(u\)</span>).</p>
<p>Initially, <span class="math inline">\(f_{u, 0} = \deg_u\)</span>.
Let <span class="math inline">\(son(u)\)</span> be the set containing
all <span class="math inline">\(u\)</span>’s sons. <span
class="math display">\[
f_{u, 0} = \max_{v \in son(u)} f_{v, 0} + \deg_u - 2
\]</span> Among all <span class="math inline">\(f_{v, 0}\)</span>, we
choose the largest and the second largest ones to update <span
class="math inline">\(f_{u, 1}\)</span>. Let their sum be <span
class="math inline">\(s\)</span>. <span class="math display">\[
f_{u, 1} = s + \deg_u - 4
\]</span> The final answer is the maximum among all <span
class="math inline">\(f_{u, 0}\)</span> and <span
class="math inline">\(f_{u, 1}\)</span>.</p>
<p>Overall complexity: <span
class="math inline">\(\Theta(n)\)</span>.</p>
<h2 id="cf2062e1"><a
target="_blank" rel="noopener" href="https://codeforces.com/problemset/problem/2062/E1">CF2062E1</a></h2>
<blockquote>
<p>Given a tree consisting of <span class="math inline">\(n\)</span>
nodes, rooted at <span class="math inline">\(1\)</span>, where each
nodes <span class="math inline">\(i\)</span> has a weight <span
class="math inline">\(w_i\)</span>.</p>
<p>Alice and Bob are playing a game on the tree alternately, with Alice
going first.</p>
<p>In each turn, the current player must perform the following
operation:</p>
<ul>
<li><p>Let <span class="math inline">\(j\)</span> denote the node the
opponent chose in the last turn.</p></li>
<li><p>Choose a node <span class="math inline">\(i\)</span> such that
<span class="math inline">\(w_i &gt; w_j\)</span>, and delete the
subtree of node <span class="math inline">\(i\)</span>. In particular,
Alice can choose an arbitrary node <span
class="math inline">\(i\)</span> in the first turn.</p></li>
</ul>
<p>The player who <strong>cannot</strong> make a move wins. Find one of
the possible nodes Alice may choose in the first turn so that she can
win if both of the players play optimally.</p>
</blockquote>
<p><strong>Claim.</strong> Alice should choose node <span
class="math inline">\(i\)</span> with the maximum <span
class="math inline">\(w_i\)</span> such that there exists a <span
class="math inline">\(j\)</span> with <span class="math inline">\(w_j
&gt; w_i\)</span> and <span class="math inline">\(j\)</span> is not in
the subtree of <span class="math inline">\(i\)</span>.</p>
<p><strong>Proof.</strong> Assume that after Alice chose <span
class="math inline">\(i\)</span> and Bob chose <span
class="math inline">\(j\)</span>, there exists another node <span
class="math inline">\(k\)</span> where <span class="math inline">\(w_k
&gt; w_j\)</span> and <span class="math inline">\(k\)</span> is not in
the subtree of <span class="math inline">\(j\)</span>. Since <span
class="math inline">\(w_k &gt; w_j &gt; w_i\)</span> and <span
class="math inline">\(k\)</span> is not in the subtree of <span
class="math inline">\(j\)</span>, node <span
class="math inline">\(j\)</span> would have been chosen by Alice, which
contradicts the condition.</p>
<p>To determine whether such a node <span
class="math inline">\(j\)</span> exists, perform a DFS traversal of the
tree and record the timestamp <span class="math inline">\(in_u\)</span>
when node <span class="math inline">\(u\)</span> is first met and <span
class="math inline">\(out_u\)</span> when the subtree of node <span
class="math inline">\(u\)</span> has been visited.</p>
<p>Let <span class="math inline">\(a_{in_u} = w_u\)</span>. Now we only
need to check if <span class="math display">\[
\max\left(\max_{1\le i &lt; in_u}a_i, \max_{out_u &lt; i \le n}
a_i\right) &gt; w_u.
\]</span> Overall complexity: <span
class="math inline">\(\Theta(n)\)</span>.</p>
<h2 id="cf2136f1"><a
target="_blank" rel="noopener" href="https://codeforces.com/contest/2136/problem/F1">CF2136F1</a></h2>
<blockquote>
<p><em>This is an interactive problem.</em></p>
<p>The jury has a hidden value <span class="math inline">\(W (1\le W \le
10^5)\)</span>, and you need to determine the value of <span
class="math inline">\(W\)</span> within <span
class="math inline">\(2\)</span> queries. In each query, you have to
provide an integer array <span class="math inline">\(a\)</span> of
length <span class="math inline">\(n (1\le n \le 10^5)\)</span> and the
jury will return <span class="math inline">\(f(a)\)</span>, which is
defined as follows:</p>
<ul>
<li>If <span class="math inline">\(\max a_i &gt; W\)</span>, <span
class="math inline">\(f(a) = 0\)</span>.</li>
<li>Otherwise, perform the following process:
<ul>
<li>Initially, set <span class="math inline">\(l = 1\)</span> and <span
class="math inline">\(s = 0\)</span>.</li>
<li>For each <span class="math inline">\(1\le i\le n\)</span>:
<ul>
<li>If <span class="math inline">\(s + a_i\le W\)</span>, increase <span
class="math inline">\(s\)</span> by <span
class="math inline">\(a_i\)</span> while <span
class="math inline">\(l\)</span> remains unchanged.</li>
<li>Otherwise, increase <span class="math inline">\(l\)</span> by <span
class="math inline">\(1\)</span> and set <span
class="math inline">\(s\)</span> to <span
class="math inline">\(a_i\)</span>.</li>
</ul></li>
<li><span class="math inline">\(f(a)\)</span> is equal to <span
class="math inline">\(l\)</span> after the process.</li>
</ul></li>
</ul>
</blockquote>
<p>Let <span class="math inline">\(T = 10^5\)</span>. In the first
query, ask <span class="math inline">\(10^5\)</span> copies of <span
class="math inline">\(1\)</span>, and get <span class="math inline">\(l
= \left\lceil \dfrac{T}{W} \right\rceil\)</span>.</p>
<p>If <span class="math inline">\(l = 1\)</span>, then <span
class="math inline">\(W = T = 10^5\)</span>.</p>
<p>Otherwise, <span class="math inline">\(l &gt; 1\)</span>, and we can
determine that <span class="math display">\[
\left\lceil \dfrac{T}{l} \right\rceil \le W &lt;
\left\lceil\dfrac{T}{l-1}\right\rceil.
\]</span> Let <span class="math inline">\(L = \left\lceil \dfrac{T}{l}
\right\rceil\)</span> and <span class="math inline">\(R =
\left\lceil\dfrac{T}{l-1}\right\rceil - 1\)</span>. If <span
class="math inline">\(L = R\)</span>, then <span class="math inline">\(W
= L\)</span>.</p>
<p>Otherwise, we use the second query to determine the value of <span
class="math inline">\(W\)</span>.</p>
<p><strong>Key observation: <span class="math inline">\(2L &gt;
R\)</span> always holds.</strong></p>
<p><strong>Proof. </strong> We have <span
class="math inline">\(\left\lceil\dfrac{T}{L} \right\rceil =
\left\lceil\dfrac{T}{R} \right\rceil\)</span>, and <span
class="math inline">\(\left\lceil\dfrac{T}{2L} \right\rceil =
\left\lceil\dfrac{\frac{T}{L}}{2} \right\rceil =
\left\lceil\dfrac{\left\lceil\frac{T}{L} \right\rceil}{2} \right\rceil
&lt; \left\lceil\dfrac{T}{L} \right\rceil = \left\lceil\dfrac{T}{R}
\right\rceil\)</span>. Therefore, <span class="math inline">\(2L &gt;
R\)</span>.</p>
<p>In the second query, construct the array <span
class="math inline">\(a\)</span> by concatenating pairs <span
class="math inline">\((L, 1),(L,2),\cdots, (L,R-L)\)</span> i.e. <span
class="math display">\[
[L,1,L,2,\cdots,L,R-L]
\]</span> Consider pair <span class="math inline">\((L, x)\)</span> and
the process. <span class="math inline">\(l\)</span> will be increased by
<span class="math inline">\(1\)</span> after processing at most <span
class="math inline">\(2\)</span> adjacent elements since <span
class="math inline">\(L + x + L &gt; R\)</span>.</p>
<p>If <span class="math inline">\(x \le W- L\)</span>, each pair <span
class="math inline">\((L, x)\)</span> increases <span
class="math inline">\(l\)</span> by <span
class="math inline">\(1\)</span>.</p>
<p>Otherwise, <span class="math inline">\(W - L &lt; x \le R -
L\)</span>, so each element increases <span
class="math inline">\(l\)</span> by <span
class="math inline">\(1\)</span>.</p>
<p>Thus, we can imply that <span class="math display">\[
l = W - L + 2(R - W)
\]</span> i.e. <span class="math display">\[
W = 2R - L - l.
\]</span></p>
<h2 id="cf2123g"><a
target="_blank" rel="noopener" href="https://codeforces.com/problemset/problem/2123/G">CF2123G</a></h2>
<blockquote>
<p>Given an integer <span class="math inline">\(m\)</span> and an array
<span class="math inline">\(a\)</span> consisting of <span
class="math inline">\(n\)</span> nonnegative integers smaller than <span
class="math inline">\(m\)</span>.</p>
<ul>
<li><span class="math inline">\(1 \ i \ x\)</span>: assign <span
class="math inline">\(a_i := x\)</span>;</li>
<li><span class="math inline">\(2 \ k\)</span>: in one operation, you
may choose an element <span class="math inline">\(a_i\)</span> and
assign <span class="math inline">\(a_i:=(a_i+k)(\bmod m)\)</span>.
Determine if there exists some sequence of (possibly zero) operations to
make <span class="math inline">\(a\)</span> nondecreasing.</li>
</ul>
<p>Instances of query 2 are independent while instances of query 1 are
persistent.</p>
</blockquote>
<p>For a fixed <span class="math inline">\(k\)</span>, assume we perform
<span class="math inline">\(t\)</span> operations on <span
class="math inline">\(a_i\)</span>. Since <span
class="math inline">\(\gcd(m, k) | m\)</span>, the following always
holds: <span class="math display">\[
(a_i + tk) \bmod m \equiv (a_i + tk) \pmod{\gcd(m, k)}
\]</span> <strong>Proof.</strong> Let <span class="math inline">\(x =
a_i + tk\)</span>. Rewrite <span class="math inline">\(x \bmod
m\)</span> as follows: <span class="math display">\[
x \bmod m = x - \left\lfloor\dfrac{x}{m} \right\rfloor m
\]</span> Hence, <span class="math display">\[
x - \left\lfloor\dfrac{x}{m} \right\rfloor m \equiv x -
\left\lfloor\dfrac{x}{m} \right\rfloor \gcd(m, k)\dfrac{m}{\gcd(m, k)}
\equiv x \pmod {\gcd(m, k)}.
\]</span> Thus, <span class="math inline">\(a_i \bmod \gcd(m,
k)\)</span> remains unchanged, regardless of the number of operations
performed.</p>
<p>Additionally, we can imply that <span
class="math inline">\(a_i\)</span> can reach arbitrary value <span
class="math inline">\(v\)</span> satisfying the following
conditions:</p>
<ul>
<li><span class="math inline">\(a_i + tk \equiv v\pmod m\)</span>,</li>
<li><span class="math inline">\(a_i \equiv v\pmod {\gcd(m,
k)}\)</span>.</li>
</ul>
<p>Now, we want to know if <span class="math inline">\(a_i\)</span> can
become sorted by changing <span class="math inline">\(a_i\)</span> to
<span class="math inline">\(v\)</span> such that <span
class="math inline">\(a_i \equiv v \pmod {\gcd(m, k)}\)</span>.</p>
<p>Consider an <span class="math inline">\(\Theta(n)\)</span> greedy
approach. Initially, we let <span class="math inline">\(a_1\)</span> be
the smallest nonnegative integer <span class="math inline">\(v\)</span>
such that <span class="math inline">\(a_i \equiv v\pmod{\gcd(m,
k)}\)</span>. Subsequently, for each <span class="math inline">\(a_i
(2\le i \le n)\)</span>, let it be the smallest integer <span
class="math inline">\(v \ge a_{i-1}\)</span> such that <span
class="math inline">\(a_i \equiv v\pmod{\gcd(m, k)}\)</span>. If <span
class="math inline">\(a_n &lt; m\)</span>, we can say that <span
class="math inline">\(a\)</span> can become sorted. Otherwise, it
can’t.</p>
<p>The approach needs optimizing.</p>
<p>Let <span class="math inline">\(d\)</span> be the difference array of
<span class="math inline">\(a\)</span> i.e. <span
class="math inline">\(d_i = a_i - a_{i - 1}\)</span>. In particular,
<span class="math inline">\(a_0 = 0\)</span>.</p>
<p>We have <span class="math display">\[
a_n = \sum_{i=1}^n d_i
\]</span> And because <span class="math inline">\(a_i \ge
a_{i-1}\)</span>, we must have <span class="math inline">\(d_i \ge
0\)</span>.</p>
<p>Therefore, we simply make every <span
class="math inline">\(d_i\)</span> the smallest nonnegative integer
<span class="math inline">\(v\)</span> such that <span
class="math inline">\(d_i \equiv v\pmod {\gcd(m,k)}\)</span> and check
if the sum of all <span class="math inline">\(d_i\)</span> is less than
<span class="math inline">\(m\)</span>.</p>
<p>Note that <span class="math inline">\(\gcd(m, k)\)</span> is a
divisor of <span class="math inline">\(m\)</span>. For each divisor
<span class="math inline">\(d\)</span> of <span
class="math inline">\(m\)</span>, run the process above and maintain the
sum of all <span class="math inline">\(d_i\)</span>, respectively. Also,
we observe that a modification <span class="math inline">\(a_i :=
x\)</span> only affects the value of <span
class="math inline">\(d_i\)</span> and <span class="math inline">\(d_{i
+ 1}\)</span>. Hence, the solution is enough to handle <span
class="math inline">\(q\)</span> queries efficiently.</p>
<p>Time complexity per testcase: <span
class="math inline">\(\Theta(d(m))\)</span>, where <span
class="math inline">\(d(m)\)</span> denotes the number of divisors of
<span class="math inline">\(m\)</span>.</p>
<h2 id="cf2124e"><a
target="_blank" rel="noopener" href="https://codeforces.com/contest/2124/problem/E">CF2124E</a></h2>
<blockquote>
<p>Given an array <span class="math inline">\(a\)</span>, consisting of
<span class="math inline">\(n\)</span> positive integers. You are
allowed to do the following operation:</p>
<ul>
<li>Select an array <span class="math inline">\(b\)</span> of size <span
class="math inline">\(n\)</span> such that the following properties
hold:
<ul>
<li><span class="math inline">\(0≤b_i≤a_i\)</span> for each <span
class="math inline">\(1\le i\le n\)</span>.</li>
<li>There exists an index <span class="math inline">\(1\le
i&lt;n\)</span> such that <span
class="math inline">\(b_1+b_2+\dots+b_i=b_{i+1}+b_{i+2}+\dots+b_n\)</span>.</li>
</ul></li>
<li>Then, subtract <span class="math inline">\(b_i\)</span> from <span
class="math inline">\(a_i\)</span> for each <span
class="math inline">\(1\le i \le n\)</span>.</li>
</ul>
<p>Your task is to change all the elements to <span
class="math inline">\(0\)</span>. Find the <strong>minimum</strong>
number of operations required.</p>
<p>Then, output a way to perform the operations. If it is impossible to
change all the elements of a to <span class="math inline">\(0\)</span>
no matter how many operations are used, print <span
class="math inline">\(-1\)</span> instead.</p>
<p><span class="math inline">\(2\le n\le 5\cdot10^4, 1\le a_i \le
10^{12}\)</span>.</p>
</blockquote>
<p>First, let’s determine when there is no solution. Let <span
class="math display">\[
\begin{aligned}
&amp;S = \sum\limits_{i=1}^n a_i\\
s = b_1+b_2+\dots+&amp;b_i=b_{i+1}+b_{i+2}+\dots+b_n
\end{aligned}
\]</span> In one operation, we subtract <span
class="math inline">\(2s\)</span> from <span
class="math inline">\(S\)</span>. If <span
class="math inline">\(S\)</span> is odd, there is definitely no
solution.</p>
<p>Let <span class="math inline">\(mx\)</span> be the maximum value
among all <span class="math inline">\(a_i\)</span>. Once we subtract
<span class="math inline">\(s\)</span> from <span
class="math inline">\(mx\)</span>, we subtract <span
class="math inline">\(s\)</span> from sum of the rest of the elements as
well. Thus, if <span class="math inline">\(2mx &gt; S\)</span>, we
cannot make <span class="math inline">\(mx\)</span> become <span
class="math inline">\(0\)</span>.</p>
<p>Otherwise, there must exist a solution. We can simply subtract <span
class="math inline">\(1\)</span> from an element and <span
class="math inline">\(1\)</span> from <span
class="math inline">\(mx\)</span>.</p>
<hr />
<p>Now, we need to minimize the number of operations.</p>
<p>Let’s make some observations by considering cases where <span
class="math inline">\(n\)</span> is small.</p>
<p>If <span class="math inline">\(n = 2\)</span>, it is obvious that a
solution exists if and only if <span class="math inline">\(a_1 =
a_2\)</span>.</p>
<p>If <span class="math inline">\(n=3\)</span>, there are two simple
cases where <span class="math inline">\(a_1 = a_2 + a_3\)</span> and
<span class="math inline">\(a_1 + a_2 = a_3\)</span> with only <span
class="math inline">\(1\)</span> operations required.</p>
<p>Otherwise, we have <span class="math display">\[
2a_2 \le a_1 + a_2 + a_3 \Leftrightarrow a_2 \le a_1 + a_3
\]</span> Consider the case where <span class="math inline">\(a_1 + a_3
= a_2\)</span>. We can always find a solution with <span
class="math inline">\(2\)</span> operations.</p>
<ul>
<li>Choose <span class="math inline">\(b = [a_1, a_1, 0]\)</span>. After
the operation, <span class="math inline">\(a = [0, a_2 - a_1, a_3] = [0,
a_3, a_3]\)</span>.</li>
<li>Choose <span class="math inline">\(b = [0, a_3, a_3]\)</span>. After
the operation, <span class="math inline">\(a= [0, 0, 0]\)</span>.</li>
</ul>
<p>Now let’s generalize to <span class="math inline">\(a_2 \le a_1 +
a_3\)</span>. We can perform the following operation to reduce to <span
class="math inline">\(a_1 + a_3 = a_2\)</span>, and we find a solution
with <span class="math inline">\(3\)</span> operations:</p>
<ul>
<li>Choose <span class="math inline">\(b = \left[ \frac{a_1 + a_3 -
a_2}{2}, 0, \frac{a_1 + a_3 - a_2}{2} \right]\)</span>. After the
operation, <span class="math inline">\(a= [\frac{a_1 - a_3 + a_2}{2},
a_2, \frac{a_2 - a_1 + a_3}{2}]\)</span>.</li>
<li>Choose <span class="math inline">\(b = [\frac{a_1 - a_3 + a_2}{2},
\frac{a_1 - a_3 + a_2}{2}, 0]\)</span>. After the operation, <span
class="math inline">\(a = [0, \frac{a_2 - a_1 + a_3}{2}, \frac{a_2 - a_1
+ a_3}{2}]\)</span>.</li>
<li>Choose <span class="math inline">\(b = [0, \frac{a_2 - a_1 +
a_3}{2}, \frac{a_2 - a_1 + a_3}{2}]\)</span>. After the operation, <span
class="math inline">\(a = [0, 0, 0]\)</span>.</li>
</ul>
<p>Such an operation is always feasible since <span
class="math inline">\(a_1 + a_3 - a_2\)</span> and <span
class="math inline">\(a_1 + a_3 - a_2\)</span> must be even.</p>
<p>Note that we can actually combine the first two operations.</p>
<p>Thus, we find a general solution for <span class="math inline">\(n =
3\)</span> cases where <span class="math inline">\(a_2 \le a_1 +
a_3\)</span> with <span class="math inline">\(2\)</span> operations:</p>
<ul>
<li>Choose <span class="math inline">\(b = [a_1, \frac{a_1 - a_3 +
a_2}{2}, \frac{a_1 + a_3 - a_2}{2}]\)</span>. After the operation, <span
class="math inline">\(a = [0, \frac{a_2 - a_1 + a_3}{2}, \frac{a_2 - a_1
+ a_3}{2}]\)</span>.</li>
<li>Choose <span class="math inline">\(b = [0, \frac{a_2 - a_1 +
a_3}{2}, \frac{a_2 - a_1 + a_3}{2}]\)</span>. After the operation, <span
class="math inline">\(a = [0, 0, 0]\)</span>.</li>
</ul>
<hr />
<p>Now let’s generalize to <span class="math inline">\(n &gt; 3\)</span>
cases.</p>
<p>We divide the array <span class="math inline">\(a\)</span> into three
continuous subarrays, sums of which are <span class="math inline">\(s_1,
s_2, s_3\)</span>, respectively. In this way, we reduce to <span
class="math inline">\(n=3\)</span> cases above.</p>
<p>Note that <span class="math inline">\(2\max(s_1, s_2, s_3) \le
S\)</span> must hold.</p>
<p>To satisfy the condition, we will find the first <span
class="math inline">\(p\)</span> satisfying <span
class="math display">\[
2\sum_{i=1}^{p-1} a_i \le S \wedge 2\sum_{i=1}^p a_i &gt; S
\]</span> and let the first subarray be <span class="math inline">\(a[1,
\dots, p - 1]\)</span>, the second be <span
class="math inline">\(a_{p}\)</span>, the third be <span
class="math inline">\(a[p +1, \dots, n]\)</span>.</p>
<p>Overall complexity: <span
class="math inline">\(\Theta(n)\)</span>.</p>
<h2 id="cf1992g"><a
target="_blank" rel="noopener" href="https://codeforces.com/contest/1992/problem/G">CF1992G</a></h2>
<blockquote>
<p>Let <span class="math inline">\(\textrm{MEX}(S, k)\)</span> be the
<span class="math inline">\(k\)</span>-th <strong>positive</strong>
integer in ascending order that is not present in <span
class="math inline">\(S\)</span>.</p>
<p>Denote <span class="math inline">\(\textrm{MEOW}(a)\)</span> as the
sum of <span class="math inline">\(\textrm{MEX}(b, |b| + 1)\)</span>
over all distinct subsets <span class="math inline">\(b\)</span> of
array <span class="math inline">\(a\)</span>.</p>
<p>Given an array <span class="math inline">\(a\)</span> of length <span
class="math inline">\(n\)</span>, consisting of <span
class="math inline">\(1,2,\dots, n\)</span>. Determine the value of
<span class="math inline">\(\textrm{MEOW}(a)\)</span>.</p>
<p><span class="math inline">\(1\le n \le 5000\)</span>.</p>
</blockquote>
<p>Consider a subset <span class="math inline">\(b\)</span> of array
<span class="math inline">\(a\)</span>. Assume that the maximum value in
<span class="math inline">\(b\)</span> is <span
class="math inline">\(m\)</span>, and there are exactly <span
class="math inline">\(x\)</span> numbers <span
class="math inline">\(&lt; m\)</span> that are not present in <span
class="math inline">\(b\)</span>. We have <span class="math display">\[
\begin{gather*}
m - x = |b| \\
\textrm{MEX}(b, |b| + 1) = \textrm{MEX}(b, m - x + 1)
\end{gather*}
\]</span> For convenience, let <span class="math inline">\(T =
\operatorname{MEX}(b, m - x + 1)\)</span>. We now distinguish between
two cases.</p>
<p>If <span class="math inline">\(|b| + 1 = m - x + 1 &gt; x\)</span>,
i.e. <span class="math inline">\(m \ge 2x\)</span>, then <span
class="math inline">\(T &gt; m\)</span> holds, which implies that <span
class="math display">\[
\begin{aligned}
T = m + |b| + 1 - x = 2m - 2x + 1
\end{aligned}
\]</span> Thus, for fixed <span class="math inline">\(m\)</span> and
<span class="math inline">\(x\)</span>, their contribution to the final
answer is <span class="math display">\[
(2m - 2x + 1)\binom{m - 1}{x}
\]</span> Otherwise, <span class="math inline">\(m &lt; 2x\)</span>,
and, <span class="math inline">\(T &lt; m\)</span> holds.</p>
<p>Since <span class="math inline">\(T\)</span> is undetermined, we can
simply enumerate all possible values of <span
class="math inline">\(T\)</span> from <span
class="math inline">\(1\)</span> to <span class="math inline">\(m -
1\)</span>.</p>
<p>Consider the current <span class="math inline">\(T\)</span>, which is
the <span class="math inline">\((m-x+1)\)</span>-th integer that is not
present. Hence, there are <span class="math inline">\(m-x\)</span>
integers <span class="math inline">\(\in [1, T)\)</span> and <span
class="math inline">\(2x-m-1\)</span> integers <span
class="math inline">\(\in (T, m)\)</span> which are not present.</p>
<p>Thus, for fixed <span class="math inline">\(m\)</span> and <span
class="math inline">\(x\)</span>, their contribution to the final answer
is</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\sum_{T=1}^{m-1}T\binom{T-1}{m - x}\binom{m - 1 - T}{2x-m-1}\\
= &amp;\sum_{T=1}^{m-1}(m-x+1)\binom{T}{m-x+1}\binom{m-1-T}{2x-m-1}\\
= &amp;(m-x+1)\binom{m}{x + 1}
\end{aligned}
\]</span></p>
<p>where the combinatorial identity</p>
<p><span class="math display">\[
\sum_{k=0}^n\binom{k}{a}\binom{n-k}{b} = \binom{n+1}{a+b+1}
\]</span></p>
<p>is applied.</p>
<p><strong>Proof.</strong> <span class="math display">\[
\begin{aligned}
&amp;\sum_{k=0}^n \binom{k}{a}\binom{n-k}{b} \\
=&amp; \sum_{k=0}^n \binom{k}{k-a}\binom{n-k}{b} \\
=&amp; \sum_{k=0}^n
(-1)^{k-a}\binom{-a-1}{k-a}(-1)^{n-k-b}\binom{-b-1}{n-k-b} \\
=&amp; (-1)^{n-a-b}\sum_{k=0}^n \binom{-a-1}{k-a}\binom{-b-1}{n-k-b} \\
=&amp; (-1)^{n-a-b}\binom{-a-b-2}{n-a-b} \\
=&amp; \binom{n+1}{n-a-b} \\
=&amp; \binom{n+1}{a+b+1} \\
\blacksquare
\end{aligned}
\]</span> We can obtain the answer by iterating <span
class="math inline">\(m\)</span> and <span
class="math inline">\(x\)</span>, and combining the contributions from
the two cases.</p>
<p>The final answer is <span class="math display">\[
\boxed{\sum_{i=1}^n\left( \sum_{j=0}^{\left\lfloor \frac{i}{2}
\right\rfloor} (2i-2j+1)\binom{i-1}{j} + \sum_{j=\left\lfloor
\frac{i}{2} \right\rfloor + 1}^{i-1}(i-j+1)\binom{i}{j+1} \right)}
\]</span> Time complexity: <span
class="math inline">\(\Theta(n^2)\)</span> per testcase.</p>
<h2 id="cf1925d"><a
target="_blank" rel="noopener" href="https://codeforces.com/contest/1925/problem/D">CF1925D</a></h2>
<blockquote>
<p>There are <span class="math inline">\(n\)</span> children in a class,
<span class="math inline">\(m\)</span> pairs among them are friends. The
<span class="math inline">\(i\)</span>-th pair who are friends have a
friendship value of <span class="math inline">\(f_i\)</span>.</p>
<p>The teacher has to go for <span class="math inline">\(k\)</span>
excursions, and for each of the excursions she chooses a pair of
children uniformly at random and independently. If a pair of friends is
chosen, their friendship value increases by <span
class="math inline">\(1\)</span> for all subsequent excursions (the
teacher can choose a pair of children more than once). The friendship
value of a pair who are not friends is considered <span
class="math inline">\(0\)</span>, and it does not change for subsequent
excursions.</p>
<p>Find the expected value of the sum of friendship values of all <span
class="math inline">\(k\)</span> pairs chosen for the excursions (at the
time of being chosen).</p>
<p><span class="math inline">\(2\le n\le 10^5, 0\le m \le
\min\left(10^5, \dfrac{n(n-1)}{2}\right), 1 \le k \le
2\cdot10^5\)</span>.</p>
</blockquote>
<p>Since the expected value is linear, we can consider the contribution
of the initial <span class="math inline">\(f\)</span> and the increments
respectively.</p>
<p>For convenience, let <span class="math inline">\(d =
\binom{n}{2}\)</span>, representing the total pairs.</p>
<p>Consider the contribution of the initial <span
class="math inline">\(f\)</span>. Let it be <span
class="math inline">\(S\)</span>. Define <span class="math display">\[
I_{i, j} = \left\{\begin{matrix}
1, &amp; f_i \text{\ is chosen for the }j \text{-th\ time} \\
0, &amp;\text{otherwise.}
\end{matrix}\right.
\]</span> Then the total number of times for which <span
class="math inline">\(f_i\)</span> is chosen is <span
class="math display">\[
X_i = \sum_{j=1}^k I_{i, j}
\]</span> Therefore, <span class="math display">\[
S = \sum_{i=1}^m f_i X_i
\]</span> Take expectations on both sides: <span class="math display">\[
\begin{aligned}
\mathbb{E}[S] =&amp; \sum_{i=1}^mf_i\mathbb{E}[X_i] \\
=&amp; \sum_{i=1}^mf_i\sum_{j=1}^k \mathbb{E}[I_{i, j}]\\
=&amp; \sum_{i=1}^mf_i\sum_{j=1}^k P(f_i \text{\ is chosen for the }j
\text{-th\ time})
\end{aligned}
\]</span> For arbitrary <span class="math inline">\(i\)</span> and <span
class="math inline">\(j\)</span>, the probability with which <span
class="math inline">\(f_i\)</span> is chosen for the <span
class="math inline">\(j\)</span>-th time is the same, which is <span
class="math inline">\(\dfrac{1}{d}\)</span>.</p>
<p>Therefore, <span class="math display">\[
\mathbb{E}[S] = \dfrac{k}{d}\sum_{i=1}^m f_i
\]</span> Consider the contribution of the increments. Let it be <span
class="math inline">\(T\)</span>. We have <span class="math display">\[
T = \sum_{i=1}^m g(X_i)
\]</span></p>
<p>where <span class="math inline">\(g(x) =
\dfrac{x(x-1)}{2}\)</span>.</p>
<p>Take expectations on both sides: <span class="math display">\[
\begin{aligned}
\mathbb{E}[T] &amp;= \sum_{i=1}^m \mathbb{E}[g(X_i)]\\
&amp;= \sum_{i=1}^m\sum_{t=0}^k g(t) P(X_i = t) \\
&amp;=
\sum_{i=1}^m\sum_{t=0}^kg(t)\binom{k}{t}\left(\dfrac{1}{d}\right)^t\left(\dfrac{d-1}{d}\right)^{k-t}\\
&amp;=
m\sum_{t=0}^k\dfrac{t(t-1)}{2}\binom{k}{t}\left(\dfrac{1}{d}\right)^t\left(\dfrac{d-1}{d}\right)^{k-t}
\end{aligned}
\]</span> where we use the binomial distribution since each pair is
chosen independently with probability <span
class="math inline">\(\dfrac{1}{d}\)</span>.</p>
<p>Thus, the final answer is <span class="math display">\[
\begin{aligned}
&amp;\mathbb{E}[S] + \mathbb{E}[T] \\
=&amp; \boxed{\dfrac{k}{d}\sum_{i=1}^m f_i +
m\sum_{t=0}^k\dfrac{t(t-1)}{2}\binom{k}{t}\left(\dfrac{1}{d}\right)^t\left(\dfrac{d-1}{d}\right)^{k-t}}\\
\blacksquare
\end{aligned}
\]</span> Time complexity: <span class="math inline">\(\Theta(m +
k)\)</span> per testcase.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/14/My-First-Blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Shirahane">
      <meta itemprop="description" content="Do something cool.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Shirahane's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/10/14/My-First-Blog/" class="post-title-link" itemprop="url">My First Blog</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-10-14 18:51:12 / Modified: 19:44:35" itemprop="dateCreated datePublished" datetime="2025-10-14T18:51:12+08:00">2025-10-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Launched this blog on Oct 14, 2025.</p>
<p>Used to post elsewhere, but I’ll be sharing stuff here from now
on.</p>
<p>Let’s do something cool.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Shirahane"
      src="/uploads/avatar.png">
  <p class="site-author-name" itemprop="name">Shirahane</p>
  <div class="site-description" itemprop="description">Do something cool.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Shirahane</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
